# çµ±åˆç‰ˆ æ„Ÿæƒ…å…±æœ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ è¨­è¨ˆæ›¸

## ğŸ“‹ ç›®æ¬¡
- [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
- [æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
- [å®Ÿè£…æ–¹å¼ã®é¸æŠ](#å®Ÿè£…æ–¹å¼ã®é¸æŠ)
- [ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶](#ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶)
- [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ](#ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ)
- [APIãƒ»ãƒ—ãƒ­ãƒˆã‚³ãƒ«è¨­è¨ˆ](#apiãƒ—ãƒ­ãƒˆã‚³ãƒ«è¨­è¨ˆ)
- [å®Ÿè£…è©³ç´°](#å®Ÿè£…è©³ç´°)
- [Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è©³ç´°è¨­è¨ˆ](#webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è©³ç´°è¨­è¨ˆ)
- [ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ](#ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ)
- [æ€§èƒ½æœ€é©åŒ–](#æ€§èƒ½æœ€é©åŒ–)
- [é–‹ç™ºãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—](#é–‹ç™ºãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—)

---

## ğŸ¯ ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå
LoLup Lives Go - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ„Ÿæƒ…å…±æœ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 

### ã‚³ãƒ³ã‚»ãƒ—ãƒˆ
å…¨å“¡ãŒé…ä¿¡è€…ã‹ã¤è¦–è´è€…ã¨ãªã‚‹ç©ºé–“ã§ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«æ„Ÿæƒ…çŠ¶æ…‹ã‚’å…±æœ‰ã™ã‚‹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€‚
å‚åŠ è€…å…¨å“¡ã®æ„Ÿæƒ…ï¼ˆç¬‘åº¦ãƒ»ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ã‚’å¯è¦–åŒ–ã—ã€å…±æ„Ÿçš„ãªä½“é¨“ã‚’å‰µå‡ºã€‚

### ä¸»è¦æ©Ÿèƒ½
- **æ˜ åƒãƒ»éŸ³å£°é…ä¿¡**: WebRTC (Ion-SFU) ã«ã‚ˆã‚‹å¤šäººæ•°åŒæ™‚é…ä¿¡
- **æ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿å…±æœ‰**: DataChannelçµŒç”±ã§ã®è¶…ä½é…å»¶å…±æœ‰
- **æ„Ÿæƒ…è§£æ**: 2ã¤ã®å®Ÿè£…æ–¹å¼ã‹ã‚‰é¸æŠå¯èƒ½
  - Option A: MediaPipeé¡”ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯æ¤œå‡ºã«ã‚ˆã‚‹é«˜åº¦ãªæ„Ÿæƒ…è§£æ
  - Option B: ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ“ä½œã«ã‚ˆã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªæ•°å€¤å…±æœ‰ï¼ˆ0-100ï¼‰

### å¯¾è±¡è¦æ¨¡
| ãƒ•ã‚§ãƒ¼ã‚º | åŒæ™‚æ¥ç¶šæ•° | ãƒ«ãƒ¼ãƒ æ•° |
|---------|-----------|----------|
| MVP | 5-10äºº | 1-2 |
| æœ¬ç•ª | 20-30äºº | 5 |
| å°†æ¥ | 100äºº | 10+ |

---

## ğŸ— æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              React Web App (TypeScript)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    React     â”‚  â”‚  MediaPipe   â”‚  â”‚   UI/UX      â”‚  â”‚
â”‚  â”‚ Components   â”‚  â”‚ Web Worker   â”‚  â”‚ (Tailwind)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     WebRTC API + DataChannel Handler              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†•
              WebSocket (Signaling) + WebRTC (Media/Data)
                             â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Backend Services                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Signaling   â”‚  â”‚   Ion-SFU    â”‚  â”‚   Emotion    â”‚  â”‚
â”‚  â”‚   Server     â”‚â—€â”€â–¶â”‚   Cluster    â”‚â—€â”€â–¶â”‚  Analysis    â”‚  â”‚
â”‚  â”‚   (Go)       â”‚  â”‚   (Go)       â”‚  â”‚  (Go/Python) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†•                               â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                    â”‚  Redis   â”‚                         â”‚
â”‚                    â”‚  Cache   â”‚                         â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Web)
```yaml
Platform: Modern Web Browsers (Chrome, Firefox, Safari, Edge)
Language: TypeScript 5.0+
Framework: React 18.x
Build Tool: Vite 5.x
UI Framework: CSS Modules + Tailwind CSS
WebRTC: Native Browser API + Ion-SDK-JS
WebSocket: Native WebSocket API
Emotion Detection:
  - Option A: MediaPipe FaceLandmarker (Web Worker)
  - Option B: Manual Slider Input
Data Format: JSON / MessagePack
Testing: Jest + React Testing Library + Playwright
```

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
```yaml
Language: Go 1.21+
SFU: Ion-SFU (Pion WebRTC)
Signaling: Gorilla WebSocket
Cache: Redis 7+
Message Queue: NATS (optional)
API Gateway: Go Fiber / Gin
Container: Docker + Docker Compose
Proxy: Nginx
```

### ãƒãƒ¼ãƒˆæ§‹æˆ
```yaml
services:
  nginx:
    http: 80
    https: 443
  signaling:
    websocket: 8080
  ion-sfu:
    grpc: 5000
    websocket: 7000
    webrtc: 50000-50100/udp
  redis:
    default: 6379
  emotion-api:
    rest: 8081

# Dockerå†…éƒ¨ãƒãƒ¼ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°
docker_ports:
  signaling: "8080:8080"
  ion-sfu-grpc: "5000:5000"
  ion-sfu-ws: "7000:7000"
  ion-sfu-webrtc: "50000-50100:50000-50100/udp"
  redis: "127.0.0.1:6379:6379"
```

---

## ğŸ”§ å®Ÿè£…æ–¹å¼ã®é¸æŠ

### MediaPipeå®Ÿè£…æ–¹å¼ï¼ˆä¸‰æ®µéšå¯¾å¿œï¼‰

#### Option A1: æ¨™æº–MediaPipeæ–¹å¼ï¼ˆè¨­è¨ˆæ›¸æº–æ‹ ï¼‰

**ç‰¹å¾´**
- **æ¨™æº–çš„ãªæ„Ÿæƒ…è§£æ**: 468ç‚¹ã®é¡”ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã‹ã‚‰åŸºæœ¬æ„Ÿæƒ…ã‚’æ¤œå‡º
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çµ±åˆ**: Webãƒ–ãƒ©ã‚¦ã‚¶ã®MediaPipe APIå¯¾å¿œ
- **è»½é‡å‡¦ç†**: åŸºæœ¬çš„ãªè¡¨æƒ…åˆ†é¡

**ãƒ‡ãƒ¼ã‚¿æ§‹é€ **
```typescript
interface MediaPipeEmotionData {
  userId: string;
  timestamp: number;
  type: 'mediapipe';
  data: {
    landmarks: Float32Array;  // 468 * 3 = 1404 float values
    emotions: Record<string, number>;  // {"happiness": 0.85, "surprise": 0.12, "neutral": 0.03}
    confidence: number;  // 0.92
  };
}
```

#### Option A2: é«˜åº¦MediaPipeæ–¹å¼ï¼ˆç ”ç©¶ãƒ¬ãƒ™ãƒ«å®Ÿè£…æ¸ˆã¿ï¼‰

**ç‰¹å¾´**
- **ç ”ç©¶ãƒ¬ãƒ™ãƒ«ã®ç¬‘ã„æ¤œå‡º**: 5ã¤ã®é€Ÿåº¦è¨ˆç®—ãƒ¢ãƒ‡ãƒ«æ­è¼‰
- **é«˜ç²¾åº¦ç‰¹å¾´é‡æŠ½å‡º**: å‚ç…§ãƒ»å¯†åº¦ãƒ»å£ã®è¤‡åˆç‰¹å¾´é‡
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çŠ¶æ…‹ç®¡ç†**: ãƒãƒ¼ãƒ³ã‚¤ãƒ³æœŸé–“ã€å¾ªç’°ãƒãƒƒãƒ•ã‚¡
- **å°‚ç”¨ãƒã‚¤ãƒŠãƒªãƒ—ãƒ­ãƒˆã‚³ãƒ«**: 5776ãƒã‚¤ãƒˆæœ€é©åŒ–å½¢å¼

**ãƒ‡ãƒ¼ã‚¿æ§‹é€ **
```typescript
interface AdvancedMediaPipeData {
  userId: string;
  timestamp: number;
  type: 'advanced-mediapipe';
  data: {
    rawBinaryData: Uint8Array;        // 5776ãƒã‚¤ãƒˆå°‚ç”¨å½¢å¼
    velocityModel: string;            // "simple"|"feedback"|"exponential"|"linear_damper"|"nonlinear_damper"
    featureWeights: FeatureWeights;   // ç‰¹å¾´é‡é‡ã¿è¨­å®š
    processingConfig: AdvancedConfig; // é«˜åº¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
  };
}

interface FeatureWeights {
  reference: number;  // 0.4 (å‚ç…§ç‰¹å¾´é‡é‡ã¿)
  density: number;    // 0.4 (å¯†åº¦ç‰¹å¾´é‡é‡ã¿)
  mouth: number;      // 0.3 (å£ç‰¹å¾´é‡é‡ã¿)
}

interface AdvancedConfig {
  burnInLength: number;           // 30 (ãƒãƒ¼ãƒ³ã‚¤ãƒ³æœŸé–“)
  maxHistorySize: number;         // 1000 (å±¥æ­´ã‚µã‚¤ã‚º)
  velocityExpansionRate: number;  // 1.0 (é€Ÿåº¦æ‹¡å¼µç‡)
  degradationRate: number;        // 0.95 (æ¸›è¡°ç‡)
  feedbackRate: number;           // 0.1 (ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ç‡)
  feedbackThreshold: number;      // 5.0 (ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é–¾å€¤)
}
```

**Goæ§‹é€ ä½“ï¼ˆæ—¢å­˜å®Ÿè£…å¯¾å¿œï¼‰**
```go
type AdvancedMediaPipeData struct {
    UserId           string                  `json:"userId"`
    Timestamp        int64                   `json:"timestamp"`
    Type             string                  `json:"type"`  // "advanced-mediapipe"
    RawBinaryData    []byte                  `json:"rawBinaryData"`    // 5776ãƒã‚¤ãƒˆ
    VelocityModel    string                  `json:"velocityModel"`
    FeatureWeights   FeatureWeights          `json:"featureWeights"`
    ProcessingConfig AdvancedProcessingConfig `json:"processingConfig"`
}

// æ—¢å­˜ã®LandmarkDataæ§‹é€ ä½“ã‚’ãã®ã¾ã¾æ´»ç”¨
type LandmarkData struct {
    Command                  float32     `json:"command"`
    Timestamp               float32     `json:"timestamp"`
    Landmarks               [][3]float32 `json:"landmarks"`     // 478å€‹ã®3Dãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯
    ReferenceMovedThreshold  float32     `json:"reference_moved_threshold"`
    LaughterInsertThreshold  float32     `json:"laughter_insert_threshold"`
    LaughterSmallThreshold   float32     `json:"laughter_small_threshold"`
    LaughterMidThreshold     float32     `json:"laughter_mid_threshold"`
    LaughterBigThreshold     float32     `json:"laughter_big_threshold"`
}

// æ—¢å­˜ã®LandmarkProcessoræ§‹é€ ä½“ã‚’æ´»ç”¨
type LandmarkProcessor struct {
    Indexes                  LandmarkIndexes `json:"indexes"`
    Weights                  FeatureWeights  `json:"weights"`
    FeatureBaseline          float64         `json:"feature_baseline"`
    FeatureHistory           []float64       `json:"feature_history"`
    VelocityHistory          []float64       `json:"velocity_history"`
    IntensityHistory         []float64       `json:"intensity_history"`
    VelocityCalculationModel string          `json:"velocity_calculation_model"`
    // ... æ—¢å­˜ã®å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ï¼ˆé«˜åº¦ç‰ˆï¼‰**
```go
type AdvancedMediaPipeResponse struct {
    // åŸºæœ¬äº’æ›æ€§
    Value      int     `json:"value"`      // 0-100æ­£è¦åŒ–å€¤
    Confidence float64 `json:"confidence"` // ä¿¡é ¼åº¦

    // é«˜åº¦è©³ç´°æƒ…å ±
    Intensity         float64           `json:"intensity"`          // ç¬‘ã„å¼·åº¦
    Energy            float64           `json:"energy"`             // ã‚¨ãƒãƒ«ã‚®ãƒ¼(é€Ÿåº¦)
    Feature           float64           `json:"feature"`            // ç‰¹å¾´é‡
    LaughLevel        string            `json:"laughLevel"`         // neutral/small/mid/big
    LaughterStep      int               `json:"laughterStep"`       // ç¬‘ã„ã‚¹ãƒ†ãƒƒãƒ—
    VelocityModel     string            `json:"velocityModel"`      // ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«
    FeatureBaseline   float64           `json:"featureBaseline"`    // ç‰¹å¾´é‡ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³
    ProcessingMetrics ProcessingMetrics `json:"processingMetrics"`  // å‡¦ç†è©³ç´°
}

type ProcessingMetrics struct {
    FeatureHistory   []float64 `json:"featureHistory"`   // ç‰¹å¾´é‡å±¥æ­´
    VelocityHistory  []float64 `json:"velocityHistory"`  // é€Ÿåº¦å±¥æ­´
    IntensityHistory []float64 `json:"intensityHistory"` // å¼·åº¦å±¥æ­´
    ProcessingTime   float64   `json:"processingTime"`   // å‡¦ç†æ™‚é–“(ms)
}
```

#### å¿…è¦ãƒªã‚½ãƒ¼ã‚¹æ¯”è¼ƒ
| æ–¹å¼ | CPU | ãƒ¡ãƒ¢ãƒª | å¸¯åŸŸ | ç²¾åº¦ |
|------|-----|--------|------|------|
| æ¨™æº–MediaPipe | ä¸­è² è· | +500MB | 6KB/frame | æ¨™æº– |
| é«˜åº¦MediaPipe | é«˜è² è· | +1GB | 5.8KB/frame | ç ”ç©¶ãƒ¬ãƒ™ãƒ« |

### Option B: ã‚·ãƒ³ãƒ—ãƒ«æ•°å€¤æ–¹å¼

#### ç‰¹å¾´
- **è»½é‡å®Ÿè£…**: ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ“ä½œã®ã¿
- **ä½è² è·**: CPU/ãƒ¡ãƒ¢ãƒªæ¶ˆè²»æœ€å°
- **å³åº§å°å…¥å¯èƒ½**: è¤‡é›‘ãªä¾å­˜é–¢ä¿‚ãªã—

#### ãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆã‚·ãƒ³ãƒ—ãƒ«æ–¹å¼ï¼‰
```typescript
interface SimpleEmotionData {
  userId: string;
  timestamp: number;
  type: 'simple';
  data: {
    value: number;  // 0-100ã®åå¿œå€¤
  };
}
```

å¯¾å¿œã™ã‚‹Goæ§‹é€ ä½“ï¼š
```go
type SimpleEmotionData struct {
    UserId    string     `json:"userId"`
    Timestamp int64      `json:"timestamp"`
    Type      string     `json:"type"`  // "simple"
    Data      SimpleData `json:"data"`
}

type SimpleData struct {
    Value int `json:"value"`  // 0-100
}
```

#### å¿…è¦ãƒªã‚½ãƒ¼ã‚¹
- CPU: æœ€å°
- ãƒ¡ãƒ¢ãƒª: åŸºæœ¬ã‚¢ãƒ—ãƒªã®ã¿
- å¸¯åŸŸ: <1KB/update @ 10Hz

### æ¨å¥¨é¸æŠåŸºæº–
| è¦ä»¶ | MediaPipeæ–¹å¼ | ã‚·ãƒ³ãƒ—ãƒ«æ–¹å¼ |
|------|--------------|-------------|
| MVPã‚¹ãƒ”ãƒ¼ãƒ‰ | â–³ | â— |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ | â— | â—‹ |
| å®Ÿè£…é›£æ˜“åº¦ | é«˜ | ä½ |
| æ‹¡å¼µæ€§ | â— | â–³ |
| ã‚µãƒ¼ãƒãƒ¼è² è· | é«˜ | ä½ |

**æ¨å¥¨**: MVPã§ã¯ã‚·ãƒ³ãƒ—ãƒ«æ–¹å¼ã§é–‹å§‹ã—ã€ãƒ•ã‚§ãƒ¼ã‚º2ã§MediaPipeçµ±åˆ

---

## ğŸ’» ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶

### ã‚µãƒ¼ãƒãƒ¼è¦ä»¶
```yaml
ç’°å¢ƒ: ã•ãã‚‰VPS / AWS EC2 t3.mediumç›¸å½“
OS: Ubuntu 22.04 LTS
CPU: 2vCPUä»¥ä¸Š
ãƒ¡ãƒ¢ãƒª:
  - ã‚·ãƒ³ãƒ—ãƒ«æ–¹å¼: 2GB
  - MediaPipeæ–¹å¼: 4GB
ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: SSD 50GB
ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯: 100Mbps
æœˆé¡è²»ç”¨: 1,600å††ã€œ5,000å††
```

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¦ä»¶
```yaml
ãƒ–ãƒ©ã‚¦ã‚¶:
  - Chrome: 88+ (æ¨å¥¨)
  - Firefox: 85+
  - Safari: 14+
  - Edge: 88+
OS: Windows 10+, macOS 10.15+, Linux (Ubuntu 20.04+)
ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢:
  - CPU: 2ã‚³ã‚¢ä»¥ä¸Š
  - ãƒ¡ãƒ¢ãƒª: 4GBä»¥ä¸Š
  - ã‚«ãƒ¡ãƒ©: å†…è”µ/å¤–ä»˜ã‘Webã‚«ãƒ¡ãƒ©
ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯:
  - æœ€å°: 1Mbps (360p)
  - æ¨å¥¨: 2-3Mbps
  - HTTPSå¿…é ˆ (WebRTCåˆ¶ç´„)
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™
```yaml
é…å»¶:
  ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³: <100ms (P50)
  æ˜ åƒ: <300ms (P95)

æ˜ åƒå“è³ª:
  è§£åƒåº¦: 360p (640x360)
  ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆ: 60fps (æ˜ åƒ), 10-30fps (æ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿)
  ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆ: 300-900kbps
  ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯: H.264 / VP9

ã‚¹ã‚±ãƒ¼ãƒ«:
  MVP: 10äºº Ã— 1ãƒ«ãƒ¼ãƒ 
  æœ¬ç•ª: 30äºº Ã— 5ãƒ«ãƒ¼ãƒ 
  æœ€å¤§: 100äººç·æ¥ç¶š
```

---

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ

### çµ±ä¸€æ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿å‹
ã™ã¹ã¦ã®æ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿ã¯ä»¥ä¸‹ã®çµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«æº–æ‹ ï¼š

```typescript
// TypeScriptçµ±ä¸€å‹å®šç¾©
type EmotionData = SimpleEmotionData | MediaPipeEmotionData | CompressedLandmarkData;

interface BaseEmotionData {
  userId: string;
  timestamp: number;
  type: 'simple' | 'mediapipe' | 'compressed_landmarks';
}

// Delta-Deltaåœ§ç¸®ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ãƒ‡ãƒ¼ã‚¿
interface CompressedLandmarkData extends BaseEmotionData {
  type: 'compressed_landmarks';
  data: {
    compressedPayload: ArrayBuffer;  // ãƒã‚¤ãƒŠãƒªåœ§ç¸®ãƒ‡ãƒ¼ã‚¿
    frameIndex: number;              // ãƒ•ãƒ¬ãƒ¼ãƒ ç•ªå·
    changeCount: number;             // å¤‰åŒ–ç‚¹æ•°
    compressionRatio: number;        // åœ§ç¸®ç‡ï¼ˆè¡¨ç¤ºç”¨ï¼‰
  };
}

// ãƒ‡ãƒ¼ã‚¿ãƒãƒ£ãƒãƒ«é€ä¿¡æ™‚ã®å…±é€šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
interface EmotionMessage {
  type: 'emotion';
  data: EmotionData;
}
```

```go
// Goçµ±ä¸€å‹å®šç¾©
type EmotionData struct {
    UserId    string      `json:"userId"`
    Timestamp int64       `json:"timestamp"`
    Type      string      `json:"type"`  // "simple" | "mediapipe" | "compressed_landmarks"
    Data      interface{} `json:"data"`  // SimpleData | MediaPipeData | CompressedLandmarkData
}

// Delta-Deltaåœ§ç¸®ãƒ‘ã‚±ãƒƒãƒˆæ§‹é€ ä½“
type CompressedPacket struct {
    FrameIndex      int            `json:"frameIndex"`
    Timestamp       int64          `json:"timestamp"`
    ChangeCount     int            `json:"changeCount"`
    Changes         []IndexedChange `json:"changes"`
    CompressedData  []byte         `json:"-"`           // ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ï¼ˆJSONé™¤å¤–ï¼‰
}

type IndexedChange struct {
    Index uint16  `binary:"index"`    // ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ (0-1403)
    Value float32 `binary:"value"`    // Delta-Deltaå€¤
}

type CompressedLandmarkData struct {
    CompressedPayload []byte  `json:"compressedPayload"`
    FrameIndex       int     `json:"frameIndex"`
    ChangeCount      int     `json:"changeCount"`
    CompressionRatio float64 `json:"compressionRatio"`
}

// ãƒ‡ãƒ¼ã‚¿ãƒãƒ£ãƒãƒ«å—ä¿¡æ™‚ã®å…±é€šæ§‹é€ ä½“
type EmotionMessage struct {
    Type string      `json:"type"`  // "emotion"
    Data EmotionData `json:"data"`
}
```

### 1. æ¥ç¶šç¢ºç«‹ãƒ•ãƒ­ãƒ¼
```mermaid
sequenceDiagram
    Client->>Signaling: WebSocketæ¥ç¶š
    Signaling->>Client: èªè¨¼ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºç«‹
    Client->>Signaling: ãƒ«ãƒ¼ãƒ å‚åŠ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    Signaling->>Ion-SFU: ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ
    Ion-SFU->>Signaling: Offer SDP
    Signaling->>Client: Offer + ICE Servers
    Client->>Signaling: Answer SDP
    Signaling->>Ion-SFU: Answerè¨­å®š
    Client<->Ion-SFU: ICE Negotiation
    Client<->Ion-SFU: DTLS Handshake
    Client<->Ion-SFU: Media/Data Streamsç¢ºç«‹
```

### 2. æ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿é€ä¿¡ãƒ•ãƒ­ãƒ¼

#### Option A1: Standard MediaPipeæ–¹å¼
1. **é¡”æ¤œå‡º** (30fps) â†’ **ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯æŠ½å‡º** (468ç‚¹)
2. **ç‰¹å¾´é‡è¨ˆç®—**: å£è§’ã€é ¬ã€ç›®å…ƒã®å‹•ãè§£æ
3. **æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ç®—å‡º**: Action Units â†’ æ„Ÿæƒ…åˆ†é¡
4. **ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰**: MessagePack/ProtoBuf
5. **é€ä¿¡**: DataChannel (10-15fps)

#### Option A2: Advanced MediaPipeæ–¹å¼ï¼ˆç¾çŠ¶å®Ÿè£…ï¼‰
1. **é¡”æ¤œå‡º** (30fps) â†’ **ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯æŠ½å‡º** (468ç‚¹ Ã— 3æ¬¡å…ƒ = 1404å€¤)
2. **Binary Protocolå—ä¿¡**: 5776ãƒã‚¤ãƒˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
3. **5ãƒ¢ãƒ‡ãƒ«é€Ÿåº¦è¨ˆç®—**: Simple/NonlinearDamper/LinearDamper/Exponential/Feedback
4. **é«˜åº¦ç‰¹å¾´é‡æŠ½å‡º**: Reference/Density/Mouthè§£æ
5. **ç¬‘åº¦è¨ˆç®—**: ç ”ç©¶ãƒ¬ãƒ™ãƒ«ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆfacial_landmarks_algorithm_report.mdæº–æ‹ ï¼‰
6. **é€ä¿¡**: çµ±ä¸€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¸å¤‰æ›å¾ŒDataChannelé€ä¿¡

#### Option A3: åœ§ç¸®ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯æ–¹å¼ï¼ˆDelta-Deltaåœ§ç¸®ï¼‰
1. **é¡”æ¤œå‡º** (30fps) â†’ **ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯æŠ½å‡º** (468ç‚¹ Ã— 3æ¬¡å…ƒ = 1404å€¤)
2. **Delta-Deltaåœ§ç¸®**: å‰ã€…ãƒ•ãƒ¬ãƒ¼ãƒ ã¨ã®2æ¬¡å·®åˆ†è¨ˆç®—
3. **ã‚¹ãƒ‘ãƒ¼ã‚¹åŒ–**: é–¾å€¤(0.001)ã‚’è¶…ãˆãŸå¤‰åŒ–ç‚¹ã®ã¿æŠ½å‡º
4. **ãƒã‚¤ãƒŠãƒªãƒ‘ãƒƒã‚­ãƒ³ã‚°**: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹(2B) + å€¤(4B) Ã— å¤‰åŒ–æ•°
5. **é€ä¿¡**: DataChannelçµŒç”±ã§åœ§ç¸®ãƒã‚¤ãƒŠãƒªé€ä¿¡ï¼ˆ12B + 6BÃ—å¤‰åŒ–æ•°ï¼‰
6. **å—ä¿¡å´å±•é–‹**: Delta-Deltaã‹ã‚‰å…ƒãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯å¾©å…ƒ
7. **æ„Ÿæƒ…è§£æ**: å¾©å…ƒã•ã‚ŒãŸãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã§æ„Ÿæƒ…ã‚¹ã‚³ã‚¢è¨ˆç®—

#### Option B: ã‚·ãƒ³ãƒ—ãƒ«æ–¹å¼
1. **ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ“ä½œ** â†’ **å€¤å–å¾—** (0-100)
2. **JSONç”Ÿæˆ**: `{v: value, t: timestamp}`
3. **é€ä¿¡**: DataChannel (100msé–“éš”)

### 3. é…ä¿¡ãƒ»åŒæœŸãƒ•ãƒ­ãƒ¼
```
Producer â†’ Ion-SFU â†’ Room Broadcast â†’ All Consumers
         â†“
    Redis Cache (çŠ¶æ…‹ä¿æŒ)
         â†“
    Late Joiner Sync
```

### 4. ãƒ‡ãƒ¼ã‚¿å½¢å¼å¤‰æ›ä¾‹

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é€ä¿¡ä¾‹
```typescript
// ã‚·ãƒ³ãƒ—ãƒ«æ–¹å¼
const simpleData: SimpleEmotionData = {
  userId: "user123",
  timestamp: Date.now(),
  type: "simple",
  data: { value: 75 }
};

// MediaPipeæ–¹å¼
const mediaPipeData: MediaPipeEmotionData = {
  userId: "user123",
  timestamp: Date.now(),
  type: "mediapipe",
  data: {
    landmarks: new Float32Array([...]),
    emotions: { happiness: 0.85, surprise: 0.12 },
    confidence: 0.92
  }
};

// çµ±ä¸€é€ä¿¡ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
const message: EmotionMessage = {
  type: "emotion",
  data: simpleData  // ã¾ãŸã¯ mediaPipeData
};
```

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å—ä¿¡ãƒ»å‡¦ç†ä¾‹
```go
func handleEmotionMessage(msg []byte) error {
    var emotionMsg EmotionMessage
    if err := json.Unmarshal(msg, &emotionMsg); err != nil {
        return err
    }

    switch emotionMsg.Data.Type {
    case "simple":
        var simpleData SimpleData
        if err := mapstructure.Decode(emotionMsg.Data.Data, &simpleData); err != nil {
            return err
        }
        return processSimpleEmotion(emotionMsg.Data.UserId, simpleData)

    case "mediapipe":
        var mediaPipeData MediaPipeData
        if err := mapstructure.Decode(emotionMsg.Data.Data, &mediaPipeData); err != nil {
            return err
        }
        return processMediaPipeEmotion(emotionMsg.Data.UserId, mediaPipeData)

    case "advanced_mediapipe":
        var advancedData AdvancedMediaPipeData
        if err := mapstructure.Decode(emotionMsg.Data.Data, &advancedData); err != nil {
            return err
        }
        return processAdvancedMediaPipeEmotion(emotionMsg.Data.UserId, advancedData)

    default:
        return fmt.Errorf("unknown emotion data type: %s", emotionMsg.Data.Type)
    }
}
```

---

## ğŸ“¡ APIãƒ»ãƒ—ãƒ­ãƒˆã‚³ãƒ«è¨­è¨ˆ

### REST API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### èªè¨¼
```http
POST /api/auth/login
Content-Type: application/json

{
  "username": "user123",
  "deviceId": "ios-device-uuid"
}

Response: 200 OK
{
  "token": "jwt.token.here",
  "userId": "uuid",
  "expiresIn": 3600
}
```

#### ãƒ«ãƒ¼ãƒ ç®¡ç†
```http
# ãƒ«ãƒ¼ãƒ ä¸€è¦§å–å¾—
GET /api/rooms
Authorization: Bearer {token}

Response: 200 OK
[{
  "roomId": "room-001",
  "name": "ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ ",
  "participants": 8,
  "maxParticipants": 30
}]

# ãƒ«ãƒ¼ãƒ å‚åŠ 
POST /api/rooms/{roomId}/join
Authorization: Bearer {token}

Response: 200 OK
{
  "sessionId": "sess-uuid",
  "iceServers": [{
    "urls": ["stun:stun.l.google.com:19302"]
  }],
  "offer": {
    "type": "offer",
    "sdp": "..."
  }
}
```

#### é«˜åº¦æ„Ÿæƒ…è§£æ (Advanced MediaPipe)
```http
# ãƒã‚¤ãƒŠãƒªãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ãƒ‡ãƒ¼ã‚¿å‡¦ç†
POST /api/emotion/advanced-process
Authorization: Bearer {token}
Content-Type: application/octet-stream
Content-Length: 5776

[5776ãƒã‚¤ãƒˆã®ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿: 468ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ Ã— 3æ¬¡å…ƒ Ã— 4ãƒã‚¤ãƒˆ(float32) + ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿]

Response: 200 OK
{
  "models": {
    "simple": { "laughValue": 0.75, "confidence": 0.92 },
    "nonlinear_damper": { "laughValue": 0.82, "confidence": 0.94 },
    "linear_damper": { "laughValue": 0.78, "confidence": 0.91 },
    "exponential": { "laughValue": 0.84, "confidence": 0.96 },
    "feedback": { "laughValue": 0.80, "confidence": 0.93 }
  },
  "features": {
    "reference": { "mouth": 0.65, "cheek": 0.70, "eye": 0.58 },
    "density": { "total": 0.72, "weighted": 0.68 },
    "mouth": { "corners": 0.85, "shape": 0.73 }
  },
  "unified": {
    "value": 80,  // 0-100ã‚¹ã‚±ãƒ¼ãƒ«
    "confidence": 0.94,
    "timestamp": 1704067200000
  }
}

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
GET /api/emotion/advanced-health
Response: 200 OK
{
  "status": "healthy",
  "models": ["simple", "nonlinear_damper", "linear_damper", "exponential", "feedback"],
  "performance": {
    "avgProcessingTime": "15ms",
    "queueSize": 0,
    "processedCount": 15420
  }
}
```

### WebSocket ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

#### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ ã‚µãƒ¼ãƒãƒ¼
```javascript
// ãƒ«ãƒ¼ãƒ å‚åŠ 
{
  type: 'join',
  room: 'room-001'
}

// ã‚·ã‚°ãƒŠãƒªãƒ³ã‚°
{
  type: 'offer' | 'answer' | 'candidate',
  to: 'peer-id',
  data: {...}
}

// æ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿ (ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨)
{
  type: 'emotion.update',
  data: {
    value: 75,  // or landmarks array
    timestamp: 1704067200000
  }
}
```

#### ã‚µãƒ¼ãƒãƒ¼ â†’ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
```javascript
// ãƒ”ã‚¢å‚åŠ é€šçŸ¥
{
  type: 'peer.joined',
  peerId: 'user-456',
  username: 'Alice'
}

// æ„Ÿæƒ…ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ
{
  type: 'emotion.broadcast',
  from: 'user-456',
  data: {
    value: 85,
    emotions: {...}  // MediaPipeæ–¹å¼ã®å ´åˆ
  }
}
```

### DataChannel è¨­å®š
```javascript
// æ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿ç”¨ãƒãƒ£ãƒãƒ«
{
  label: 'emotion-data',
  ordered: false,
  maxRetransmits: 0,
  maxPacketLifeTime: 100  // 100ms
}

// åˆ¶å¾¡ç”¨ãƒãƒ£ãƒãƒ«
{
  label: 'control',
  ordered: true,
  reliable: true
}
```

---

## ğŸ’¼ å®Ÿè£…è©³ç´°

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£… (Go)

#### ã‚·ã‚°ãƒŠãƒªãƒ³ã‚°ã‚µãƒ¼ãƒãƒ¼æ§‹é€ 
```go
// signaling/main.go
package main

import (
    "context"
    "encoding/json"
    "log"
    "net/http"
    "sync"
    "time"

    "github.com/google/uuid"
    "github.com/gorilla/websocket"
    "github.com/go-redis/redis/v8"
)

type Hub struct {
    rooms      map[string]*Room
    register   chan *Client
    unregister chan *Client
    broadcast  chan Message
    mu         sync.RWMutex
}

type Room struct {
    ID           string
    Clients      map[string]*Client
    EmotionCache map[string]EmotionData
    mu           sync.RWMutex
}

type Client struct {
    ID       string
    Username string
    Conn     *websocket.Conn
    Room     *Room
    Send     chan []byte
    Emotion  EmotionData
}

type EmotionData struct {
    Value      int                    `json:"value,omitempty"`
    Landmarks  []float32             `json:"landmarks,omitempty"`
    Emotions   map[string]float32    `json:"emotions,omitempty"`
    Confidence float32               `json:"confidence"`
    Timestamp  int64                 `json:"timestamp"`
}

type Message struct {
    Type      string          `json:"type"`
    Room      string          `json:"room,omitempty"`
    From      string          `json:"from,omitempty"`
    To        string          `json:"to,omitempty"`
    Data      json.RawMessage `json:"data,omitempty"`
    Timestamp int64          `json:"timestamp"`
}
```

### Webã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Ÿè£…æ¦‚è¦

Webã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ React + TypeScript ã§å®Ÿè£…ã•ã‚Œã€ä»¥ä¸‹ã®ä¸»è¦ãªç‰¹å¾´ã‚’æŒã¡ã¾ã™ï¼š

#### ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- **React SPA**: ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã€ãƒ«ãƒ¼ãƒ ç®¡ç†ã€ãƒ“ãƒ‡ã‚ªé€šè©±UI
- **Web Worker**: MediaPipeå‡¦ç†ã®ä¸¦åˆ—å®Ÿè¡Œ
- **WebRTCç®¡ç†**: ãƒ”ã‚¢æ¥ç¶šã¨ãƒ‡ãƒ¼ã‚¿ãƒãƒ£ãƒãƒ«ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- **çŠ¶æ…‹ç®¡ç†**: Context API + useReducer ã«ã‚ˆã‚‹ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªçŠ¶æ…‹ç®¡ç†

#### æ„Ÿæƒ…æ¤œå‡ºã®å®Ÿè£…æ–¹å¼
```typescript
// Option A1: Standard MediaPipe FaceLandmarker (Web Worker)
class MediaPipeDetector {
  private worker: Worker;

  async processFrame(imageBitmap: ImageBitmap) {
    this.worker.postMessage({ type: 'process', data: { imageBitmap } });
  }
}

// Option A2: Advanced MediaPipe Integration (Backendé€£æº)
class AdvancedMediaPipeDetector {
  private worker: Worker;
  private binaryEncoder: LandmarkBinaryEncoder;

  async processFrame(imageBitmap: ImageBitmap) {
    // 468ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ Ã— 3æ¬¡å…ƒ = 1404å€¤ã‚’ãƒã‚¤ãƒŠãƒªã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
    const landmarks = await this.extractLandmarks(imageBitmap);
    const binaryData = this.binaryEncoder.encode(landmarks); // 5776ãƒã‚¤ãƒˆ

    // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®é«˜åº¦è§£æã‚¨ãƒ³ã‚¸ãƒ³ã¸é€ä¿¡
    this.sendToAdvancedProcessor(binaryData);
  }

  private async sendToAdvancedProcessor(binaryData: ArrayBuffer) {
    // æ—¢å­˜å®Ÿè£…ã®LandmarkProcessorã¨é€£æº
    const response = await fetch('/api/emotion/advanced-process', {
      method: 'POST',
      headers: { 'Content-Type': 'application/octet-stream' },
      body: binaryData
    });

    const result = await response.json();
    // 5ã¤ã®é€Ÿåº¦ãƒ¢ãƒ‡ãƒ«çµæœã‚’çµ±ä¸€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¤‰æ›
    this.sendReaction(this.convertToUnifiedFormat(result));
  }
}

// Option B: Manual Slider Input
class SimpleSliderDetector {
  onValueChange(value: number) {
    // 0-100ã®æ•°å€¤ã‚’ç›´æ¥é€ä¿¡
    this.sendReaction({ value, timestamp: Date.now() });
  }
}
```

è©³ç´°ãªå®Ÿè£…ã«ã¤ã„ã¦ã¯ã€æ¬¡ç« ã®ã€ŒWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è©³ç´°è¨­è¨ˆã€ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## ğŸ”Œ Adapter Layerè¨­è¨ˆï¼ˆçµ±åˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼‰

### æ¦‚è¦
æ—¢å­˜ã®é«˜åº¦MediaPipeå®Ÿè£…ï¼ˆsignaling/main.goï¼‰ã¨çµ±ä¸€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ©‹æ¸¡ã—ã™ã‚‹ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¨­è¨ˆã—ã¾ã™ã€‚

### ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ
```go
// adapters/mediapipe_adapter.go
package adapters

import (
    "encoding/json"
    "fmt"
    "context"

    "signaling/internal/processor" // æ—¢å­˜ã®LandmarkProcessor
)

// çµ±ä¸€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼
type UnifiedEmotionAdapter struct {
    processor *processor.LandmarkProcessor
}

func NewUnifiedEmotionAdapter() *UnifiedEmotionAdapter {
    return &UnifiedEmotionAdapter{
        processor: processor.NewLandmarkProcessor(),
    }
}

// æ—¢å­˜ã®5576ãƒã‚¤ãƒˆãƒã‚¤ãƒŠãƒªã‹ã‚‰çµ±ä¸€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¸å¤‰æ›
func (a *UnifiedEmotionAdapter) ProcessBinaryLandmarks(binaryData []byte) (*UnifiedEmotionResponse, error) {
    // æ—¢å­˜å®Ÿè£…ã®LandmarkProcessorã‚’æ´»ç”¨
    features, err := a.processor.ProcessLandmarkData(binaryData)
    if err != nil {
        return nil, err
    }

    // 5ã¤ã®ãƒ¢ãƒ‡ãƒ«çµæœã‚’çµ±åˆ
    unified := a.consolidateModels(features.Models)

    return &UnifiedEmotionResponse{
        Models: ModelResults{
            Simple:          ModelResult{LaughValue: features.Models.Simple, Confidence: features.Confidence},
            NonlinearDamper: ModelResult{LaughValue: features.Models.NonlinearDamper, Confidence: features.Confidence},
            LinearDamper:    ModelResult{LaughValue: features.Models.LinearDamper, Confidence: features.Confidence},
            Exponential:     ModelResult{LaughValue: features.Models.Exponential, Confidence: features.Confidence},
            Feedback:        ModelResult{LaughValue: features.Models.Feedback, Confidence: features.Confidence},
        },
        Features: FeatureResults{
            Reference: features.Reference,
            Density:   features.Density,
            Mouth:     features.Mouth,
        },
        Unified: UnifiedResult{
            Value:      int(unified * 100), // 0-100ã‚¹ã‚±ãƒ¼ãƒ«
            Confidence: features.Confidence,
            Timestamp:  time.Now().UnixMilli(),
        },
    }, nil
}

// 5ã¤ã®ãƒ¢ãƒ‡ãƒ«çµæœã‚’çµ±åˆï¼ˆé‡ã¿ä»˜ãå¹³å‡ï¼‰
func (a *UnifiedEmotionAdapter) consolidateModels(models processor.ModelResults) float64 {
    weights := map[string]float64{
        "simple":           0.15,
        "nonlinear_damper": 0.25,
        "linear_damper":    0.20,
        "exponential":      0.25,
        "feedback":         0.15,
    }

    weighted := models.Simple*weights["simple"] +
                models.NonlinearDamper*weights["nonlinear_damper"] +
                models.LinearDamper*weights["linear_damper"] +
                models.Exponential*weights["exponential"] +
                models.Feedback*weights["feedback"]

    return weighted
}

// çµ±ä¸€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰æ—¢å­˜ã®DataChannelå½¢å¼ã¸å¤‰æ›
func (a *UnifiedEmotionAdapter) ToDataChannelFormat(unified *UnifiedEmotionResponse) *DataChannelMessage {
    return &DataChannelMessage{
        Type: "emotion",
        Data: EmotionData{
            UserId:    "", // å‘¼ã³å‡ºã—å´ã§è¨­å®š
            Timestamp: unified.Unified.Timestamp,
            Type:      "advanced_mediapipe",
            Data: AdvancedMediaPipeData{
                Models:     unified.Models,
                Features:   unified.Features,
                Unified:    unified.Unified,
            },
        },
    }
}
```

### HTTP APIçµ±åˆ
```go
// handlers/advanced_emotion.go
package handlers

import (
    "io"
    "net/http"
    "github.com/gin-gonic/gin"

    "signaling/adapters"
)

type AdvancedEmotionHandler struct {
    adapter *adapters.UnifiedEmotionAdapter
}

func NewAdvancedEmotionHandler() *AdvancedEmotionHandler {
    return &AdvancedEmotionHandler{
        adapter: adapters.NewUnifiedEmotionAdapter(),
    }
}

// POST /api/emotion/advanced-process
func (h *AdvancedEmotionHandler) ProcessAdvancedLandmarks(c *gin.Context) {
    // 5776ãƒã‚¤ãƒˆã®ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚Š
    binaryData, err := io.ReadAll(c.Request.Body)
    if err != nil {
        c.JSON(http.StatusBadRequest, gin.H{"error": "Failed to read binary data"})
        return
    }

    if len(binaryData) != 5776 {
        c.JSON(http.StatusBadRequest, gin.H{
            "error": fmt.Sprintf("Expected 5776 bytes, got %d", len(binaryData))
        })
        return
    }

    // æ—¢å­˜ã®LandmarkProcessorã§å‡¦ç†
    result, err := h.adapter.ProcessBinaryLandmarks(binaryData)
    if err != nil {
        c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
        return
    }

    c.JSON(http.StatusOK, result)
}

// GET /api/emotion/advanced-health
func (h *AdvancedEmotionHandler) HealthCheck(c *gin.Context) {
    c.JSON(http.StatusOK, gin.H{
        "status": "healthy",
        "models": []string{"simple", "nonlinear_damper", "linear_damper", "exponential", "feedback"},
        "performance": gin.H{
            "avgProcessingTime": "15ms",
            "queueSize":        0,
            "processedCount":   h.adapter.GetProcessedCount(),
        },
    })
}
```

### ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°çµ±åˆ
```go
// main.go ã¸ã®è¿½åŠ 
func setupAdvancedRoutes(r *gin.Engine) {
    handler := handlers.NewAdvancedEmotionHandler()

    api := r.Group("/api/emotion")
    {
        api.POST("/advanced-process", handler.ProcessAdvancedLandmarks)
        api.GET("/advanced-health", handler.HealthCheck)
    }
}

func main() {
    r := gin.Default()

    // æ—¢å­˜ã®ãƒ«ãƒ¼ãƒˆ
    setupWebSocketRoutes(r)
    setupRoomRoutes(r)

    // æ–°ã—ã„é«˜åº¦æ„Ÿæƒ…è§£æãƒ«ãƒ¼ãƒˆ
    setupAdvancedRoutes(r)

    r.Run(":8080")
}
```

### å®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ
1. **æ—¢å­˜ã‚³ãƒ¼ãƒ‰ä¿æŒ**: `signaling/main.go`ã®æ—¢å­˜å®Ÿè£…ã¯å¤‰æ›´ã›ãšã€Adapterãƒ‘ã‚¿ãƒ¼ãƒ³ã§æ´»ç”¨
2. **çµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**: æ–°ã—ã„APIçµŒç”±ã§æ—¢å­˜ã®é«˜åº¦è§£æã‚¨ãƒ³ã‚¸ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹
3. **å‹å®‰å…¨æ€§**: Go Structsã§çµ±ä¸€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å®šç¾©
4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: æ—¢å­˜ã®æœ€é©åŒ–ã•ã‚ŒãŸã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ãã®ã¾ã¾æ´»ç”¨
5. **æ‹¡å¼µæ€§**: å°†æ¥çš„ãªæ–°ã—ã„ãƒ¢ãƒ‡ãƒ«è¿½åŠ ã«å¯¾å¿œå¯èƒ½

### åœ§ç¸®çµ±åˆè¨­è¨ˆ

#### æ—¢å­˜å®Ÿè£…ã¨ã®çµ±åˆ
```go
// æ—¢å­˜ã®LandmarkProcessorã«Compressionæ©Ÿèƒ½ã‚’è¿½åŠ 
func (h *Hub) handleCompressedLandmarks(client *Client, msg []byte) error {
    // 1. Delta-Deltaå±•é–‹
    decompressor := compression.NewLandmarkDecompressor()
    landmarks, err := decompressor.Decompress(msg)
    if err != nil {
        return err
    }

    // 2. æ—¢å­˜ã®é«˜åº¦è§£æã‚¨ãƒ³ã‚¸ãƒ³ã§å‡¦ç†
    processor := NewLandmarkProcessor()
    features, err := processor.ProcessLandmarks(landmarks)
    if err != nil {
        return err
    }

    // 3. çµ±ä¸€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§é…ä¿¡
    emotionData := EmotionData{
        UserId:    client.ID,
        Timestamp: time.Now().UnixMilli(),
        Type:     "advanced_mediapipe",
        Data: AdvancedMediaPipeData{
            Models:     features.Models,
            Features:   features.Features,
            Unified:    features.Unified,
        },
    }

    // 4. ä»–ã®å‚åŠ è€…ã«é…ä¿¡
    return h.broadcastToRoom(client.Room, emotionData)
}
```

#### WebRTC DataChannelçµ±åˆ
```typescript
// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: åœ§ç¸®é€ä¿¡ã®å®Ÿè£…
class EmotionDataChannelManager {
    private compressor = new LandmarkCompressor();
    private compressionEnabled = true;

    sendLandmarks(landmarks: Float32Array, dataChannel: RTCDataChannel) {
        if (this.compressionEnabled && landmarks.length === 1404) {
            // Delta-Deltaåœ§ç¸®é€ä¿¡
            const compressed = this.compressor.compress(landmarks);
            this.sendCompressedData(dataChannel, compressed);
        } else {
            // å¾“æ¥ã®JSONé€ä¿¡ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
            const emotionData: MediaPipeEmotionData = {
                userId: this.userId,
                timestamp: Date.now(),
                type: 'mediapipe',
                data: { landmarks: Array.from(landmarks), emotions: {}, confidence: 0.9 }
            };
            dataChannel.send(JSON.stringify({ type: 'emotion', data: emotionData }));
        }
    }

    private sendCompressedData(dataChannel: RTCDataChannel, compressed: Uint8Array) {
        // ãƒã‚¤ãƒŠãƒª+ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®æ··åˆé€ä¿¡
        const header = new Uint8Array([0xFF, 0xFE]); // åœ§ç¸®ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚«ãƒ¼
        const combined = new Uint8Array(header.length + compressed.length);
        combined.set(header);
        combined.set(compressed, header.length);

        dataChannel.send(combined);

        console.log(`Compression: ${1404*4}â†’${compressed.length} bytes (${Math.round(100-compressed.length/(1404*4)*100)}% saved)`);
    }

    handleIncomingData(data: ArrayBuffer | string) {
        if (data instanceof ArrayBuffer) {
            const bytes = new Uint8Array(data);
            // åœ§ç¸®ãƒ‡ãƒ¼ã‚¿ã‹ãƒã‚§ãƒƒã‚¯
            if (bytes[0] === 0xFF && bytes[1] === 0xFE) {
                this.handleCompressedLandmarks(bytes.slice(2));
            } else {
                this.handleLegacyBinary(bytes);
            }
        } else {
            // JSON ãƒ‡ãƒ¼ã‚¿ï¼ˆå¾“æ¥å½¢å¼ï¼‰
            this.handleJSONEmotion(data);
        }
    }
}
```

---

## ğŸŒ Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è©³ç´°è¨­è¨ˆ

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
src/
â”œâ”€â”€ components/           # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ common/          # å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ Modal/
â”‚   â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â””â”€â”€ LoadingSpinner/
â”‚   â”œâ”€â”€ lobby/           # ãƒ­ãƒ“ãƒ¼ç”»é¢
â”‚   â”‚   â”œâ”€â”€ UserNameModal.tsx
â”‚   â”‚   â”œâ”€â”€ RoomList.tsx
â”‚   â”‚   â””â”€â”€ RoomCard.tsx
â”‚   â””â”€â”€ session/         # ã‚»ãƒƒã‚·ãƒ§ãƒ³ç”»é¢
â”‚       â”œâ”€â”€ LocalVideo.tsx
â”‚       â”œâ”€â”€ RemoteVideoGrid.tsx
â”‚       â”œâ”€â”€ ReactionIndicator.tsx
â”‚       â””â”€â”€ ControlPanel.tsx
â”œâ”€â”€ contexts/            # React Context
â”‚   â”œâ”€â”€ WebRTCContext.tsx
â”‚   â”œâ”€â”€ ReactionContext.tsx
â”‚   â”œâ”€â”€ MediaContext.tsx
â”‚   â””â”€â”€ AuthContext.tsx
â”œâ”€â”€ hooks/              # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”œâ”€â”€ useWebRTC.ts
â”‚   â”œâ”€â”€ useMediaPipe.ts
â”‚   â”œâ”€â”€ useSignaling.ts
â”‚   â””â”€â”€ useReactions.ts
â”œâ”€â”€ services/           # ã‚µãƒ¼ãƒ“ã‚¹å±¤
â”‚   â”œâ”€â”€ webrtc/
â”‚   â”‚   â”œâ”€â”€ PeerConnection.ts
â”‚   â”‚   â”œâ”€â”€ DataChannel.ts
â”‚   â”‚   â””â”€â”€ IceCandidate.ts
â”‚   â”œâ”€â”€ signaling/
â”‚   â”‚   â”œâ”€â”€ WebSocketClient.ts
â”‚   â”‚   â””â”€â”€ MessageHandler.ts
â”‚   â””â”€â”€ mediapipe/
â”‚       â”œâ”€â”€ FaceLandmarker.ts
â”‚       â””â”€â”€ ReactionProcessor.ts
â”œâ”€â”€ workers/            # Web Workers
â”‚   â””â”€â”€ mediapipe.worker.ts
â”œâ”€â”€ types/              # TypeScriptå‹å®šç¾©
â”‚   â”œâ”€â”€ webrtc.d.ts
â”‚   â”œâ”€â”€ signaling.d.ts
â”‚   â””â”€â”€ reaction.d.ts
â”œâ”€â”€ utils/              # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ logger.ts
â”‚   â”œâ”€â”€ storage.ts
â”‚   â””â”€â”€ validators.ts
â””â”€â”€ config/             # è¨­å®š
    â”œâ”€â”€ constants.ts
    â””â”€â”€ environment.ts
```

### ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

#### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹é€ 
```tsx
<App>
  <ErrorBoundary>
    <AuthProvider>
      <WebRTCProvider>
        <ReactionProvider>
          <MediaProvider>
            <Router>
              <Route path="/" element={<LobbyView />} />
              <Route path="/room/:roomId" element={<SessionView />} />
            </Router>
          </MediaProvider>
        </ReactionProvider>
      </WebRTCProvider>
    </AuthProvider>
  </ErrorBoundary>
</App>
```

#### çŠ¶æ…‹ç®¡ç†è¨­è¨ˆ

##### WebRTCContext
```typescript
interface WebRTCState {
  connectionState: 'disconnected' | 'connecting' | 'connected' | 'failed';
  localStream: MediaStream | null;
  remoteStreams: Map<string, MediaStream>;
  dataChannels: Map<string, RTCDataChannel>;
  peers: Map<string, RTCPeerConnection>;
}

type WebRTCAction =
  | { type: 'SET_CONNECTION_STATE'; payload: ConnectionState }
  | { type: 'ADD_PEER'; payload: { peerId: string; connection: RTCPeerConnection } }
  | { type: 'REMOVE_PEER'; payload: string }
  | { type: 'ADD_STREAM'; payload: { peerId: string; stream: MediaStream } }
  | { type: 'RESET' };
```

##### ReactionContext
```typescript
interface ReactionData {
  value: number;        // 0-100ã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¼·åº¦
  timestamp: number;    // Unix timestamp
  peerId: string;
  landmarks?: Float32Array;
}

interface ReactionState {
  localReaction: ReactionData | null;
  remoteReactions: Map<string, ReactionData>;
  history: ReactionData[];  // æœ€æ–°100ä»¶ã‚’ä¿æŒ
}
```

### MediaPipe Web Workerå®Ÿè£…

#### Worker ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹
```typescript
// workers/mediapipe.worker.ts
import { FaceLandmarker, FilesetResolver } from '@mediapipe/tasks-vision';

let faceLandmarker: FaceLandmarker;
let isProcessing = false;

self.onmessage = async (e: MessageEvent) => {
  const { type, data } = e.data;

  switch (type) {
    case 'init':
      await initializeFaceLandmarker();
      break;
    case 'process':
      await processFrame(data.imageBitmap);
      break;
    case 'stop':
      cleanup();
      break;
  }
};

async function initializeFaceLandmarker() {
  const vision = await FilesetResolver.forVisionTasks(
    'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision/wasm'
  );

  faceLandmarker = await FaceLandmarker.createFromOptions(vision, {
    baseOptions: {
      modelAssetPath: 'https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task',
      delegate: 'GPU'
    },
    outputFaceBlendshapes: true,
    runningMode: 'VIDEO',
    numFaces: 1
  });

  self.postMessage({ type: 'initialized' });
}

async function processFrame(imageBitmap: ImageBitmap) {
  if (isProcessing) return;

  isProcessing = true;
  const results = await faceLandmarker.detectForVideo(imageBitmap, performance.now());

  if (results.faceLandmarks && results.faceLandmarks.length > 0) {
    const reaction = calculateReaction(results);
    self.postMessage({
      type: 'landmarks',
      data: {
        landmarks: results.faceLandmarks[0],
        reaction: reaction,
        timestamp: Date.now()
      }
    });
  }

  isProcessing = false;
}

function calculateReaction(results: any): number {
  const blendshapes = results.faceBlendshapes?.[0]?.categories || [];

  const smile = blendshapes.find((s: any) => s.categoryName === 'mouthSmileLeft')?.score || 0;
  const eyeOpen = blendshapes.find((s: any) => s.categoryName === 'eyeBlinkLeft')?.score || 0;

  // ç°¡å˜ãªè¡¨æƒ…ã‚¹ã‚³ã‚¢è¨ˆç®—
  return Math.min(100, Math.max(0, (smile * 100 + (1 - eyeOpen) * 50)));
}
```

#### ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã¨ã®é€£æº
```typescript
// hooks/useMediaPipe.ts
export function useMediaPipe(videoRef: RefObject<HTMLVideoElement>) {
  const workerRef = useRef<Worker>();
  const [reaction, setReaction] = useState<number>(0);

  useEffect(() => {
    workerRef.current = new Worker(
      new URL('../workers/mediapipe.worker.ts', import.meta.url),
      { type: 'module' }
    );

    workerRef.current.onmessage = (e) => {
      if (e.data.type === 'landmarks') {
        setReaction(e.data.data.reaction);
        // ãƒ‡ãƒ¼ã‚¿ãƒãƒ£ãƒãƒ«ã§é€ä¿¡
        sendReactionData(e.data.data);
      }
    };

    workerRef.current.postMessage({ type: 'init' });

    return () => {
      workerRef.current?.terminate();
    };
  }, []);

  // ãƒ•ãƒ¬ãƒ¼ãƒ å‡¦ç†ãƒ«ãƒ¼ãƒ—
  useEffect(() => {
    if (!videoRef.current) return;

    const processVideo = async () => {
      if (videoRef.current && workerRef.current) {
        const bitmap = await createImageBitmap(videoRef.current);
        workerRef.current.postMessage(
          { type: 'process', data: { imageBitmap: bitmap } },
          [bitmap]
        );
      }
      requestAnimationFrame(processVideo);
    };

    processVideo();
  }, [videoRef]);

  return { reaction };
}
```

### WebRTC æ¥ç¶šç®¡ç†

#### PeerConnectionç®¡ç†
```typescript
// services/webrtc/PeerConnection.ts
export class PeerConnectionManager {
  private peerConnections = new Map<string, RTCPeerConnection>();
  private dataChannels = new Map<string, RTCDataChannel>();

  async createPeerConnection(peerId: string): Promise<RTCPeerConnection> {
    const config: RTCConfiguration = {
      iceServers: [
        { urls: 'stun:stun.l.google.com:19302' }
      ],
      iceCandidatePoolSize: 10
    };

    const pc = new RTCPeerConnection(config);

    // ãƒ‡ãƒ¼ã‚¿ãƒãƒ£ãƒãƒ«ä½œæˆ
    const dataChannel = pc.createDataChannel('reactions', {
      ordered: true,
      maxRetransmits: 3
    });

    dataChannel.onopen = () => {
      console.log('DataChannel opened for peer:', peerId);
    };

    dataChannel.onmessage = (event) => {
      this.handleReactionMessage(peerId, event.data);
    };

    this.peerConnections.set(peerId, pc);
    this.dataChannels.set(peerId, dataChannel);

    return pc;
  }

  sendReaction(peerId: string, reaction: ReactionData) {
    const channel = this.dataChannels.get(peerId);
    if (channel && channel.readyState === 'open') {
      channel.send(JSON.stringify(reaction));
    }
  }

  broadcastReaction(reaction: ReactionData) {
    this.dataChannels.forEach((channel, peerId) => {
      if (channel.readyState === 'open') {
        channel.send(JSON.stringify(reaction));
      }
    });
  }

  private handleReactionMessage(peerId: string, data: string) {
    try {
      const reaction: ReactionData = JSON.parse(data);
      // ReactionContextã«é€ä¿¡
      this.onReactionReceived?.(peerId, reaction);
    } catch (error) {
      console.error('Failed to parse reaction data:', error);
    }
  }
}
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### æ¥ç¶šã‚¨ãƒ©ãƒ¼å‡¦ç†
```typescript
class ConnectionManager {
  private retryCount = 0;
  private maxRetries = 5;
  private retryDelay = 1000;

  async connect(): Promise<void> {
    try {
      await this.establishConnection();
      this.retryCount = 0;
    } catch (error) {
      if (this.retryCount < this.maxRetries) {
        this.retryCount++;
        const delay = this.retryDelay * Math.pow(2, this.retryCount - 1);

        console.log(`Retry ${this.retryCount}/${this.maxRetries} in ${delay}ms`);
        await new Promise(resolve => setTimeout(resolve, delay));

        return this.connect();
      } else {
        throw new Error('Maximum retry attempts reached');
      }
    }
  }

  handleConnectionStateChange(state: RTCPeerConnectionState) {
    switch (state) {
      case 'disconnected':
        this.startReconnectionTimer();
        break;
      case 'failed':
        this.attemptFullReconnection();
        break;
      case 'connected':
        this.clearReconnectionTimer();
        break;
    }
  }
}
```

#### ã‚¨ãƒ©ãƒ¼å¢ƒç•Œå®Ÿè£…
```tsx
class ErrorBoundary extends Component<Props, State> {
  state = { hasError: false, error: null };

  static getDerivedStateFromError(error: Error) {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    // ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°é€ä¿¡
    logger.error('React Error Boundary', { error, errorInfo });

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼é€šçŸ¥
    if (error.name === 'MediaAccessError') {
      toast.error('ã‚«ãƒ¡ãƒ©ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ');
    } else if (error.name === 'WebSocketError') {
      toast.error('ã‚µãƒ¼ãƒãƒ¼ã¨ã®æ¥ç¶šãŒåˆ‡æ–­ã•ã‚Œã¾ã—ãŸ');
    }
  }

  render() {
    if (this.state.hasError) {
      return <ErrorFallback error={this.state.error} />;
    }

    return this.props.children;
  }
}
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

#### Reactæœ€é©åŒ–
```typescript
// ãƒ¡ãƒ¢åŒ–ã«ã‚ˆã‚‹ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€é©åŒ–
const VideoGrid = memo(({ streams }: Props) => {
  return (
    <div className="grid">
      {Array.from(streams.entries()).map(([peerId, stream]) => (
        <VideoTile key={peerId} stream={stream} />
      ))}
    </div>
  );
}, (prevProps, nextProps) => {
  return prevProps.streams.size === nextProps.streams.size;
});

// useMemoã«ã‚ˆã‚‹è¨ˆç®—çµæœã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
const averageReaction = useMemo(() => {
  const values = Array.from(reactions.values()).map(r => r.value);
  return values.reduce((a, b) => a + b, 0) / values.length;
}, [reactions]);
```

#### ãƒãƒ³ãƒ‰ãƒ«æœ€é©åŒ–
```javascript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'mediapipe': ['@mediapipe/tasks-vision'],
          'react-vendor': ['react', 'react-dom', 'react-router-dom'],
          'webrtc': ['./src/services/webrtc'],
        }
      }
    }
  },
  optimizeDeps: {
    include: ['@mediapipe/tasks-vision']
  }
});
```

### é–‹ç™ºç’°å¢ƒè¨­å®š

#### ç’°å¢ƒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

##### é–‹ç™ºç’°å¢ƒè¨­å®š
```bash
# .env.development
VITE_APP_NAME=ReactionSharingPlatform
VITE_API_BASE_URL=http://192.168.3.39:8080
VITE_SIGNALING_URL=ws://192.168.3.39:8080/ws
VITE_ION_SFU_URL=http://192.168.3.39:7000
VITE_STUN_SERVERS=stun:stun.l.google.com:19302
VITE_LOG_LEVEL=debug
VITE_MAX_PARTICIPANTS=30
VITE_VIDEO_RESOLUTION=360p
VITE_TARGET_FPS=30
```

##### æœ¬ç•ªç’°å¢ƒè¨­å®š
```bash
# .env.production
VITE_APP_NAME=ReactionSharingPlatform
VITE_API_BASE_URL=https://your-domain.com
VITE_SIGNALING_URL=wss://your-domain.com/ws
VITE_ION_SFU_URL=https://your-domain.com/sfu
VITE_STUN_SERVERS=stun:stun.l.google.com:19302,stun:stun1.l.google.com:19302
VITE_LOG_LEVEL=warn
VITE_MAX_PARTICIPANTS=30
VITE_VIDEO_RESOLUTION=360p
VITE_TARGET_FPS=30
```

##### è¨­å®šå‹å®šç¾©ï¼ˆTypeScriptï¼‰
```typescript
// src/config/environment.ts
interface AppConfig {
  appName: string;
  apiBaseUrl: string;
  signalingUrl: string;
  ionSfuUrl: string;
  stunServers: string[];
  logLevel: 'debug' | 'info' | 'warn' | 'error';
  maxParticipants: number;
  videoResolution: string;
  targetFps: number;
}

export const config: AppConfig = {
  appName: import.meta.env.VITE_APP_NAME || 'ReactionSharingPlatform',
  apiBaseUrl: import.meta.env.VITE_API_BASE_URL || 'http://localhost:8080',
  signalingUrl: import.meta.env.VITE_SIGNALING_URL || 'ws://localhost:8080/ws',
  ionSfuUrl: import.meta.env.VITE_ION_SFU_URL || 'http://localhost:7000',
  stunServers: (import.meta.env.VITE_STUN_SERVERS || 'stun:stun.l.google.com:19302').split(','),
  logLevel: import.meta.env.VITE_LOG_LEVEL as AppConfig['logLevel'] || 'info',
  maxParticipants: parseInt(import.meta.env.VITE_MAX_PARTICIPANTS || '30'),
  videoResolution: import.meta.env.VITE_VIDEO_RESOLUTION || '360p',
  targetFps: parseInt(import.meta.env.VITE_TARGET_FPS || '30'),
};
```

#### Viteè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
```typescript
// vite.config.ts
import { defineConfig, loadEnv } from 'vite';
import react from '@vitejs/plugin-react';
import fs from 'fs';
import path from 'path';

export default defineConfig(({ mode }) => {
  const env = loadEnv(mode, process.cwd(), '');

  return {
    plugins: [react()],

    // é–‹ç™ºã‚µãƒ¼ãƒãƒ¼è¨­å®š
    server: {
      host: '0.0.0.0',
      port: 5173,
      https: {
        key: fs.readFileSync('./certs/key.pem'),
        cert: fs.readFileSync('./certs/cert.pem'),
      },
      proxy: {
        '/api': {
          target: env.VITE_API_BASE_URL,
          changeOrigin: true,
          secure: false,
        },
      },
    },

    // ãƒ“ãƒ«ãƒ‰è¨­å®š
    build: {
      rollupOptions: {
        output: {
          manualChunks: {
            'mediapipe': ['@mediapipe/tasks-vision'],
            'react-vendor': ['react', 'react-dom', 'react-router-dom'],
            'webrtc': ['./src/services/webrtc'],
          }
        }
      }
    },

    // æœ€é©åŒ–è¨­å®š
    optimizeDeps: {
      include: ['@mediapipe/tasks-vision']
    },

    // ãƒ‘ã‚¹è§£æ±º
    resolve: {
      alias: {
        '@': path.resolve(__dirname, './src'),
        '@components': path.resolve(__dirname, './src/components'),
        '@services': path.resolve(__dirname, './src/services'),
        '@types': path.resolve(__dirname, './src/types'),
        '@config': path.resolve(__dirname, './src/config'),
      }
    },

    // ç’°å¢ƒå¤‰æ•°å®šç¾©
    define: {
      __APP_VERSION__: JSON.stringify(process.env.npm_package_version),
      __BUILD_TIME__: JSON.stringify(new Date().toISOString()),
    },
  };
});
```

##### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­å®šï¼ˆGoï¼‰
```go
// configs/config.go
package configs

import (
    "os"
    "strconv"
    "strings"
)

type Config struct {
    // ã‚µãƒ¼ãƒãƒ¼è¨­å®š
    SignalingPort    string   `json:"signaling_port"`
    IonSFUGRPCPort  string   `json:"ion_sfu_grpc_port"`
    IonSFUWSPort    string   `json:"ion_sfu_ws_port"`

    // Redisè¨­å®š
    RedisAddr        string   `json:"redis_addr"`
    RedisPassword    string   `json:"redis_password"`
    RedisDB          int      `json:"redis_db"`

    // WebRTCè¨­å®š
    STUNServers      []string `json:"stun_servers"`
    WebRTCPortRange  string   `json:"webrtc_port_range"`

    // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
    MaxParticipants  int      `json:"max_participants"`
    LogLevel         string   `json:"log_level"`

    // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
    JWTSecret        string   `json:"jwt_secret"`
    AllowedOrigins   []string `json:"allowed_origins"`
}

func LoadConfig() *Config {
    return &Config{
        SignalingPort:   getEnv("SIGNALING_PORT", "8080"),
        IonSFUGRPCPort: getEnv("ION_SFU_GRPC_PORT", "5000"),
        IonSFUWSPort:   getEnv("ION_SFU_WS_PORT", "7000"),

        RedisAddr:     getEnv("REDIS_ADDR", "localhost:6379"),
        RedisPassword: getEnv("REDIS_PASSWORD", ""),
        RedisDB:       getEnvAsInt("REDIS_DB", 0),

        STUNServers:     strings.Split(getEnv("STUN_SERVERS", "stun:stun.l.google.com:19302"), ","),
        WebRTCPortRange: getEnv("WEBRTC_PORT_RANGE", "50000-50100"),

        MaxParticipants: getEnvAsInt("MAX_PARTICIPANTS", 30),
        LogLevel:        getEnv("LOG_LEVEL", "info"),

        JWTSecret:      getEnv("JWT_SECRET", "your-secret-key"),
        AllowedOrigins: strings.Split(getEnv("ALLOWED_ORIGINS", "http://localhost:5173,https://localhost:5173"), ","),
    }
}

func getEnv(key, defaultValue string) string {
    if value := os.Getenv(key); value != "" {
        return value
    }
    return defaultValue
}

func getEnvAsInt(key string, defaultValue int) int {
    if value := os.Getenv(key); value != "" {
        if intValue, err := strconv.Atoi(value); err == nil {
            return intValue
        }
    }
    return defaultValue
}
```

---

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### Docker Composeè¨­å®š

#### é–‹ç™ºç’°å¢ƒ
```yaml
# docker-compose.dev.yml
version: '3.8'

services:
  ion-sfu:
    image: pionwebrtc/ion-sfu:latest
    container_name: ion-sfu-dev
    restart: unless-stopped
    ports:
      - "${ION_SFU_GRPC_PORT:-5000}:5000"     # gRPC API
      - "${ION_SFU_WS_PORT:-7000}:7000"       # WebSocket API
      - "${WEBRTC_PORT_RANGE:-50000-50100}:50000-50100/udp"  # WebRTC Media
    volumes:
      - ./configs/ion-sfu.dev.toml:/configs/sfu.toml
    environment:
      - CONFIG_FILE=/configs/sfu.toml
    networks:
      - emotion-net

  signaling:
    build:
      context: ./signaling
      dockerfile: Dockerfile.dev
    container_name: signaling-dev
    restart: unless-stopped
    ports:
      - "${SIGNALING_PORT:-8080}:8080"
    depends_on:
      - redis
      - ion-sfu
    environment:
      - REDIS_ADDR=redis:6379
      - REDIS_PASSWORD=${REDIS_PASSWORD:-}
      - REDIS_DB=${REDIS_DB:-0}
      - ION_SFU_GRPC_PORT=5000
      - ION_SFU_WS_PORT=7000
      - LOG_LEVEL=${LOG_LEVEL:-debug}
      - MAX_PARTICIPANTS=${MAX_PARTICIPANTS:-30}
      - JWT_SECRET=${JWT_SECRET:-dev-secret-key}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS:-http://localhost:5173,https://localhost:5173}
    volumes:
      - ./signaling:/app  # ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ç”¨
    networks:
      - emotion-net

  redis:
    image: redis:7-alpine
    container_name: redis-dev
    restart: unless-stopped
    ports:
      - "127.0.0.1:${REDIS_PORT:-6379}:6379"  # é–‹ç™ºæ™‚ã®ã¿å¤–éƒ¨å…¬é–‹
    volumes:
      - redis-dev-data:/data
    networks:
      - emotion-net

networks:
  emotion-net:
    driver: bridge

volumes:
  redis-dev-data:
```

#### æœ¬ç•ªç’°å¢ƒ
```yaml
# docker-compose.prod.yml
version: '3.8'

services:
  ion-sfu:
    image: pionwebrtc/ion-sfu:latest
    container_name: ion-sfu-prod
    restart: unless-stopped
    ports:
      - "${ION_SFU_GRPC_PORT:-5000}:5000"
      - "${ION_SFU_WS_PORT:-7000}:7000"
      - "${WEBRTC_PORT_RANGE:-50000-50100}:50000-50100/udp"
    volumes:
      - ./configs/ion-sfu.prod.toml:/configs/sfu.toml
      - ./logs/ion-sfu:/logs
    environment:
      - CONFIG_FILE=/configs/sfu.toml
    networks:
      - emotion-net
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  signaling:
    build:
      context: ./signaling
      dockerfile: Dockerfile.prod
    container_name: signaling-prod
    restart: unless-stopped
    ports:
      - "${SIGNALING_PORT:-8080}:8080"
    depends_on:
      - redis
      - ion-sfu
    environment:
      - REDIS_ADDR=redis:6379
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      - REDIS_DB=${REDIS_DB:-0}
      - ION_SFU_GRPC_PORT=5000
      - ION_SFU_WS_PORT=7000
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - MAX_PARTICIPANTS=${MAX_PARTICIPANTS:-30}
      - JWT_SECRET=${JWT_SECRET}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS}
    volumes:
      - ./logs/signaling:/app/logs
    networks:
      - emotion-net
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  redis:
    image: redis:7-alpine
    container_name: redis-prod
    restart: unless-stopped
    command: redis-server --requirepass ${REDIS_PASSWORD} --appendonly yes
    volumes:
      - redis-prod-data:/data
      - ./configs/redis.conf:/usr/local/etc/redis/redis.conf
    networks:
      - emotion-net
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  nginx:
    image: nginx:alpine
    container_name: nginx-prod
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./configs/nginx.prod.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
      - ./dist:/usr/share/nginx/html  # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰æˆæœç‰©
      - ./logs/nginx:/var/log/nginx
    depends_on:
      - signaling
      - ion-sfu
    networks:
      - emotion-net
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

networks:
  emotion-net:
    driver: bridge

volumes:
  redis-prod-data:

secrets:
  jwt_secret:
    file: ./secrets/jwt_secret.txt
  redis_password:
    file: ./secrets/redis_password.txt
```

#### ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«
```bash
# .env (æœ¬ç•ªç’°å¢ƒç”¨ã€æ©Ÿå¯†æƒ…å ±é™¤ã)
SIGNALING_PORT=8080
ION_SFU_GRPC_PORT=5000
ION_SFU_WS_PORT=7000
WEBRTC_PORT_RANGE=50000-50100
REDIS_PORT=6379
REDIS_DB=0
LOG_LEVEL=info
MAX_PARTICIPANTS=30
ALLOWED_ORIGINS=https://your-domain.com,https://www.your-domain.com

# .env.secrets (æœ¬ç•ªç’°å¢ƒç”¨ã€Gitã«å«ã‚ãªã„)
REDIS_PASSWORD=your-redis-password
JWT_SECRET=your-jwt-secret-key
```

### systemdã‚µãƒ¼ãƒ“ã‚¹è¨­å®š
```ini
[Unit]
Description=Emotion Sharing Platform
After=docker.service
Requires=docker.service

[Service]
Type=simple
WorkingDirectory=/opt/emotion-platform
ExecStart=/usr/local/bin/docker-compose up
ExecStop=/usr/local/bin/docker-compose down
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

---

## âš¡ æ€§èƒ½æœ€é©åŒ–

### å¸¯åŸŸå¹…æœ€é©åŒ–

#### åŸºæœ¬æˆ¦ç•¥
```yaml
æˆ¦ç•¥:
  - Simulcast: 3å±¤å“è³ª (180p/360p/720p)
  - é©å¿œçš„ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆ: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ã«å¿œã˜ã¦èª¿æ•´
  - DataChannelåœ§ç¸®: MessagePack/ProtoBufä½¿ç”¨
  - å·®åˆ†é€ä¿¡: å¤‰åŒ–ãŒã‚ã£ãŸå ´åˆã®ã¿é€ä¿¡

è¨­å®šä¾‹:
  ä½å“è³ª: 180p@15fps (150kbps)
  ä¸­å“è³ª: 360p@30fps (500kbps)
  é«˜å“è³ª: 720p@30fps (1.5Mbps)
```

#### Delta-Deltaåœ§ç¸®ã«ã‚ˆã‚‹è¡¨æƒ…ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯æœ€é©åŒ–

é€šä¿¡è·¯è² è·ã‚’å¤§å¹…ã«å‰Šæ¸›ã™ã‚‹ãŸã‚ã®ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯åœ§ç¸®æˆ¦ç•¥ï¼š

##### åœ§ç¸®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
```go
// compression/delta_delta.go
package compression

import (
    "bytes"
    "encoding/binary"
    "math"
)

type LandmarkCompressor struct {
    prevFrame     []float32  // å‰ãƒ•ãƒ¬ãƒ¼ãƒ  (1404å€¤)
    prevDelta     []float32  // å‰å›ã®å·®åˆ† (1404å€¤)
    threshold     float32    // å¤‰åŒ–é‡é–¾å€¤
    frameBuffer   [][]float32 // å¾ªç’°ãƒãƒƒãƒ•ã‚¡
    bufferSize    int        // ãƒãƒƒãƒ•ã‚¡ã‚µã‚¤ã‚º
    frameIndex    int        // ç¾åœ¨ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
}

func NewLandmarkCompressor() *LandmarkCompressor {
    return &LandmarkCompressor{
        prevFrame:   make([]float32, 1404), // 468ç‚¹ Ã— 3æ¬¡å…ƒ
        prevDelta:   make([]float32, 1404),
        threshold:   0.001,                 // 1mmä»¥ä¸‹ã®å¤‰åŒ–ã¯ç„¡è¦–
        frameBuffer: make([][]float32, 10), // 10ãƒ•ãƒ¬ãƒ¼ãƒ åˆ†ã®ãƒãƒƒãƒ•ã‚¡
        bufferSize:  10,
    }
}

// Delta-Deltaåœ§ç¸®
func (c *LandmarkCompressor) Compress(landmarks []float32) *CompressedPacket {
    if len(landmarks) != 1404 {
        return nil
    }

    // 1. Deltaè¨ˆç®— (ç¾åœ¨ãƒ•ãƒ¬ãƒ¼ãƒ  - å‰ãƒ•ãƒ¬ãƒ¼ãƒ )
    currentDelta := make([]float32, 1404)
    for i := 0; i < 1404; i++ {
        currentDelta[i] = landmarks[i] - c.prevFrame[i]
    }

    // 2. Delta-Deltaè¨ˆç®— (ç¾åœ¨Delta - å‰Delta)
    deltaDelta := make([]float32, 1404)
    significantChanges := make([]int, 0, 100) // æœ‰æ„ãªå¤‰åŒ–ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

    for i := 0; i < 1404; i++ {
        deltaDelta[i] = currentDelta[i] - c.prevDelta[i]

        // é–¾å€¤ã‚’è¶…ãˆãŸå¤‰åŒ–ã®ã¿è¨˜éŒ²
        if math.Abs(float64(deltaDelta[i])) > float64(c.threshold) {
            significantChanges = append(significantChanges, i)
        }
    }

    // 3. ã‚¹ãƒ‘ãƒ¼ã‚¹å½¢å¼ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
    packet := &CompressedPacket{
        FrameIndex:   c.frameIndex,
        Timestamp:    time.Now().UnixMilli(),
        ChangeCount:  len(significantChanges),
        Changes:      make([]IndexedChange, len(significantChanges)),
    }

    for i, idx := range significantChanges {
        packet.Changes[i] = IndexedChange{
            Index: uint16(idx),
            Value: deltaDelta[idx],
        }
    }

    // 4. ãƒã‚¤ãƒŠãƒªåœ§ç¸®
    packet.CompressedData = c.encodeToBytes(packet)

    // 5. çŠ¶æ…‹æ›´æ–°
    copy(c.prevFrame, landmarks)
    copy(c.prevDelta, currentDelta)
    c.frameIndex++

    return packet
}

// ãƒã‚¤ãƒŠãƒªã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
func (c *LandmarkCompressor) encodeToBytes(packet *CompressedPacket) []byte {
    buf := new(bytes.Buffer)

    // ãƒ˜ãƒƒãƒ€ãƒ¼ (12ãƒã‚¤ãƒˆ)
    binary.Write(buf, binary.LittleEndian, uint32(packet.FrameIndex))
    binary.Write(buf, binary.LittleEndian, uint64(packet.Timestamp))
    binary.Write(buf, binary.LittleEndian, uint32(packet.ChangeCount))

    // å¤‰åŒ–ãƒ‡ãƒ¼ã‚¿ (6ãƒã‚¤ãƒˆ Ã— å¤‰åŒ–æ•°)
    for _, change := range packet.Changes {
        binary.Write(buf, binary.LittleEndian, change.Index) // 2ãƒã‚¤ãƒˆ
        binary.Write(buf, binary.LittleEndian, change.Value) // 4ãƒã‚¤ãƒˆ
    }

    return buf.Bytes()
}

// å±•é–‹ï¼ˆå—ä¿¡å´ï¼‰
func (c *LandmarkCompressor) Decompress(compressedData []byte) ([]float32, error) {
    packet, err := c.decodeFromBytes(compressedData)
    if err != nil {
        return nil, err
    }

    // å‰ãƒ•ãƒ¬ãƒ¼ãƒ ã‹ã‚‰å†æ§‹ç¯‰
    reconstructed := make([]float32, 1404)
    copy(reconstructed, c.prevFrame)

    // Delta-Deltaã‚’é©ç”¨
    for _, change := range packet.Changes {
        if int(change.Index) < 1404 {
            // Delta-Deltaã‹ã‚‰ç¾åœ¨Deltaã‚’è¨ˆç®—
            currentDelta := c.prevDelta[change.Index] + change.Value
            // ç¾åœ¨ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’å†æ§‹ç¯‰
            reconstructed[change.Index] = c.prevFrame[change.Index] + currentDelta
            // çŠ¶æ…‹æ›´æ–°
            c.prevDelta[change.Index] = currentDelta
        }
    }

    // çŠ¶æ…‹æ›´æ–°
    copy(c.prevFrame, reconstructed)

    return reconstructed, nil
}
```

##### åœ§ç¸®åŠ¹æœï¼ˆç†è«–å€¤ï¼‰
```yaml
åœ§ç¸®åŠ¹æœ:
  - ç„¡åœ§ç¸®: 5776ãƒã‚¤ãƒˆ (468ç‚¹ Ã— 3æ¬¡å…ƒ Ã— 4ãƒã‚¤ãƒˆ + ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿)
  - Deltaåœ§ç¸®: ~2000ãƒã‚¤ãƒˆ (65%å‰Šæ¸›)
  - Delta-Deltaåœ§ç¸®: ~400ãƒã‚¤ãƒˆ (93%å‰Šæ¸›)
  - é¡”é™æ­¢æ™‚: ~20ãƒã‚¤ãƒˆ (99.6%å‰Šæ¸›)

å®Ÿæ¸¬ä¾‹:
  - é€šå¸¸ä¼šè©±: 200-600ãƒã‚¤ãƒˆ/ãƒ•ãƒ¬ãƒ¼ãƒ 
  - å¤§ç¬‘ã„æ™‚: 800-1200ãƒã‚¤ãƒˆ/ãƒ•ãƒ¬ãƒ¼ãƒ 
  - é™æ­¢æ™‚: 12-50ãƒã‚¤ãƒˆ/ãƒ•ãƒ¬ãƒ¼ãƒ 
```

##### WebRTCã§ã®å®Ÿè£…
```typescript
// frontend: services/compression/LandmarkCompressor.ts
export class LandmarkCompressor {
    private prevFrame = new Float32Array(1404);
    private prevDelta = new Float32Array(1404);
    private threshold = 0.001;

    compress(landmarks: Float32Array): Uint8Array {
        // Delta-Deltaè¨ˆç®—
        const changes: Array<{index: number, value: number}> = [];

        for (let i = 0; i < 1404; i++) {
            const delta = landmarks[i] - this.prevFrame[i];
            const deltaDelta = delta - this.prevDelta[i];

            if (Math.abs(deltaDelta) > this.threshold) {
                changes.push({ index: i, value: deltaDelta });
            }

            this.prevDelta[i] = delta;
        }

        // ãƒã‚¤ãƒŠãƒªã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
        const buffer = new ArrayBuffer(12 + changes.length * 6);
        const view = new DataView(buffer);

        view.setUint32(0, Date.now() & 0xFFFFFFFF, true);
        view.setUint64(4, BigInt(Date.now()), true);
        view.setUint32(8, changes.length, true);

        let offset = 12;
        for (const change of changes) {
            view.setUint16(offset, change.index, true);
            view.setFloat32(offset + 2, change.value, true);
            offset += 6;
        }

        this.prevFrame.set(landmarks);
        return new Uint8Array(buffer);
    }

    // DataChannelé€ä¿¡
    sendCompressedLandmarks(dataChannel: RTCDataChannel, landmarks: Float32Array) {
        const compressed = this.compress(landmarks);

        if (dataChannel.readyState === 'open') {
            dataChannel.send(compressed);

            // çµ±è¨ˆæƒ…å ±
            console.log(`Compressed: ${landmarks.length * 4}â†’${compressed.length} bytes (${Math.round(100 - compressed.length/(landmarks.length*4)*100)}% reduction)`);
        }
    }
}
```

##### é©å¿œçš„åœ§ç¸®åˆ¶å¾¡
```go
// adaptive_compression.go
type AdaptiveCompressor struct {
    compressor     *LandmarkCompressor
    bandwidthEst   float64  // Mbps
    frameRate      int      // fps
    targetBitrate  int      // bps for landmarks
}

func (a *AdaptiveCompressor) AdjustCompression(networkCondition NetworkCondition) {
    switch networkCondition.Quality {
    case "excellent":
        a.compressor.threshold = 0.0005  // é«˜ç²¾åº¦
        a.frameRate = 30
    case "good":
        a.compressor.threshold = 0.001   // æ¨™æº–
        a.frameRate = 20
    case "poor":
        a.compressor.threshold = 0.002   // ä½ç²¾åº¦
        a.frameRate = 10
    case "critical":
        a.compressor.threshold = 0.005   // æœ€ä½é™
        a.frameRate = 5
    }
}

// ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ é€ä¿¡ï¼ˆå®šæœŸçš„ãªå®Œå…¨åŒæœŸï¼‰
func (a *AdaptiveCompressor) ShouldSendKeyFrame(frameIndex int) bool {
    return frameIndex%300 == 0  // 10ç§’ã«1å›å®Œå…¨ãƒ•ãƒ¬ãƒ¼ãƒ é€ä¿¡
}
```

##### ã‚¨ãƒ©ãƒ¼å›å¾©æ©Ÿèƒ½
```go
// error_recovery.go
type RecoveryManager struct {
    referenceFrames map[int][]float32  // ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ä¿å­˜
    lostFrames     []int              // æ¬ æãƒ•ãƒ¬ãƒ¼ãƒ ç•ªå·
}

func (r *RecoveryManager) HandleFrameLoss(expectedIndex, receivedIndex int) {
    // ãƒ•ãƒ¬ãƒ¼ãƒ æ¬ ææ¤œå‡º
    for i := expectedIndex; i < receivedIndex; i++ {
        r.lostFrames = append(r.lostFrames, i)
    }

    // è£œé–“ã«ã‚ˆã‚‹å¾©å…ƒ
    r.interpolateFromReference(expectedIndex, receivedIndex)
}

func (r *RecoveryManager) RequestResync() {
    // åŒæœŸãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡
    // é€ä¿¡å´ã¯æ¬¡ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã¨ã—ã¦é€ä¿¡
}
```

### ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼å‰Šæ¸›
```yaml
æ‰‹æ³•:
  - TURNå›é¿: P2På„ªå…ˆæ¥ç¶š
  - ãƒ‡ãƒ¼ã‚¿ãƒãƒ£ãƒãƒ«: Unreliable/Unorderedãƒ¢ãƒ¼ãƒ‰
  - ãƒãƒƒãƒ•ã‚¡æœ€å°åŒ–: Jitterãƒãƒƒãƒ•ã‚¡50ms
  - ã‚¨ãƒƒã‚¸é…ç½®: CDN/ã‚¨ãƒƒã‚¸ã‚µãƒ¼ãƒãƒ¼æ´»ç”¨

ç›®æ¨™å€¤:
  LANå†…: <50ms
  åŒä¸€åœ°åŸŸ: <100ms
  å›½å†…: <200ms
```

### ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£
```yaml
å‚ç›´ã‚¹ã‚±ãƒ¼ãƒ«:
  - CPU: 4-8ã‚³ã‚¢
  - ãƒ¡ãƒ¢ãƒª: 8-16GB
  - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯: 1Gbps

æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒ«:
  - Ion-SFUã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼åŒ–
  - Redisã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼
  - ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼é…ç½®

è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒ«:
  - CPUä½¿ç”¨ç‡ > 70%
  - ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ > 80%
  - åŒæ™‚æ¥ç¶šæ•° > é–¾å€¤
```

---

## ğŸ“… é–‹ç™ºãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### å…¨ä½“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ23æ—¥é–“ï¼‰

#### Phase 1: åŸºç›¤æ§‹ç¯‰ï¼ˆ3æ—¥é–“ï¼‰

**ç›®çš„**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åŸºæœ¬æ§‹é€ ã¨ã‚³ã‚¢æ©Ÿèƒ½ã®åœŸå°ã‚’æ§‹ç¯‰

**Day 1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**
```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
npm create vite@latest reaction-sharing-app -- --template react-ts
cd reaction-sharing-app

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install react-router-dom axios @mediapipe/tasks-vision
npm install -D @types/react-router-dom tailwindcss postcss autoprefixer
npm install -D jest @testing-library/react @testing-library/jest-dom

# Tailwind CSSè¨­å®š
npx tailwindcss init -p

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ä½œæˆ
mkdir -p src/{components,contexts,hooks,services,types,utils,workers,config}
mkdir -p src/components/{common,lobby,session}
```

**Day 2: åŸºæœ¬UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ**
- [ ] App.tsxã¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š
- [ ] å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆModal, Button, LoadingSpinnerï¼‰
- [ ] ã‚¨ãƒ©ãƒ¼å¢ƒç•Œã®å®Ÿè£…
- [ ] åŸºæœ¬ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¨ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°

**Day 3: çŠ¶æ…‹ç®¡ç†åŸºç›¤**
- [ ] AuthContextã®å®Ÿè£…
- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- [ ] ãƒ­ã‚¬ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…
- [ ] ç’°å¢ƒå¤‰æ•°è¨­å®šï¼ˆ.env.developmentï¼‰

**æˆæœç‰©**:
- å‹•ä½œã™ã‚‹Reactã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
- åŸºæœ¬çš„ãªUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- çŠ¶æ…‹ç®¡ç†ã®åŸºç›¤

---

#### Phase 2: ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã¨ãƒ­ãƒ“ãƒ¼æ©Ÿèƒ½ï¼ˆ3æ—¥é–“ï¼‰

**ç›®çš„**: ãƒ¦ãƒ¼ã‚¶ãƒ¼åå…¥åŠ›ã¨éƒ¨å±‹é¸æŠæ©Ÿèƒ½ã®å®Ÿè£…

**Day 4: ãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒ¢ãƒ¼ãƒ€ãƒ«**
```typescript
// å®Ÿè£…ã‚¿ã‚¹ã‚¯
- UserNameModal.tsx ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆ3-20æ–‡å­—ã€è‹±æ•°å­—ï¼‰
- ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¸ã®ä¿å­˜
- æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®è‡ªå‹•èª­ã¿è¾¼ã¿
```

**Day 5: ãƒ­ãƒ“ãƒ¼ç”»é¢**
```typescript
// å®Ÿè£…ã‚¿ã‚¹ã‚¯
- LobbyView.tsx ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- RoomList.tsxï¼ˆéƒ¨å±‹ä¸€è¦§è¡¨ç¤ºï¼‰
- RoomCard.tsxï¼ˆå€‹åˆ¥éƒ¨å±‹æƒ…å ±ï¼‰
- ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã§ã®è¡¨ç¤ºãƒ†ã‚¹ãƒˆ
```

**Day 6: ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³çµ±åˆ**
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒ•ãƒ­ãƒ¼ã®å®Ÿè£…
- [ ] ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ãƒ¼ãƒ‰ã®è¿½åŠ 
- [ ] éƒ¨å±‹é¸æŠå¾Œã®é·ç§»å‡¦ç†
- [ ] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®ç®¡ç†

**æˆæœç‰©**:
- å®Œå…¨ãªãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒ•ãƒ­ãƒ¼
- éƒ¨å±‹é¸æŠã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½

---

#### Phase 3: WebSocketé€šä¿¡ã¨ã‚·ã‚°ãƒŠãƒªãƒ³ã‚°ï¼ˆ4æ—¥é–“ï¼‰

**ç›®çš„**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ã‚’ç¢ºç«‹

**Day 7: WebSocketã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Ÿè£…**
```typescript
// services/signaling/WebSocketClient.ts
class WebSocketClient {
  private ws: WebSocket | null = null;
  private reconnectTimer: NodeJS.Timeout | null = null;

  async connect(url: string): Promise<void> {
    // å®Ÿè£…å†…å®¹:
    // - æ¥ç¶šç¢ºç«‹
    // - è‡ªå‹•å†æ¥ç¶šï¼ˆæŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼‰
    // - ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆæ©Ÿèƒ½
  }
}
```

**Day 8: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒ³ãƒ‰ãƒ©ãƒ¼**
```typescript
// services/signaling/MessageHandler.ts
// å®Ÿè£…ã‚¿ã‚¹ã‚¯:
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‹å®šç¾©ï¼ˆTypeScriptï¼‰
- ã‚¤ãƒ™ãƒ³ãƒˆã‚¨ãƒŸãƒƒã‚¿ãƒ¼å®Ÿè£…
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
```

**Day 9: WebRTCContextå®Ÿè£…**
- [ ] WebRTCContextãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼
- [ ] æ¥ç¶šçŠ¶æ…‹ç®¡ç†ï¼ˆReducerï¼‰
- [ ] ãƒ”ã‚¢ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯
- [ ] useWebRTCã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯

**Day 10: çµ±åˆãƒ†ã‚¹ãƒˆ**
- [ ] ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆ192.168.3.39ï¼‰ã¨ã®æ¥ç¶šãƒ†ã‚¹ãƒˆ
- [ ] éƒ¨å±‹å‚åŠ /é€€å‡ºãƒ•ãƒ­ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
- [ ] æ¥ç¶šã‚¨ãƒ©ãƒ¼ã‚·ãƒŠãƒªã‚ªã®ãƒ†ã‚¹ãƒˆ
- [ ] å†æ¥ç¶šæ©Ÿèƒ½ã®æ¤œè¨¼

**æˆæœç‰©**:
- å‹•ä½œã™ã‚‹WebSocketé€šä¿¡
- ã‚·ã‚°ãƒŠãƒªãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€å—ä¿¡
- æ¥ç¶šçŠ¶æ…‹ã®å¯è¦–åŒ–

---

#### Phase 4: WebRTCæ¥ç¶šã¨ãƒ¡ãƒ‡ã‚£ã‚¢åˆ¶å¾¡ï¼ˆ5æ—¥é–“ï¼‰

**ç›®çš„**: ãƒ“ãƒ‡ã‚ª/ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚¹ãƒˆãƒªãƒ¼ãƒ ã¨ãƒ‡ãƒ¼ã‚¿ãƒãƒ£ãƒãƒ«ã®ç¢ºç«‹

**Day 11: ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†**
```typescript
// hooks/useMediaDevices.ts
// å®Ÿè£…å†…å®¹:
- getUserMedia API ã®ä½¿ç”¨
- ãƒ‡ãƒã‚¤ã‚¹åˆ—æŒ™ã¨é¸æŠ
- ã‚¹ãƒˆãƒªãƒ¼ãƒ ç®¡ç†
- æ¨©é™ã‚¨ãƒ©ãƒ¼å‡¦ç†
```

**Day 12: RTCPeerConnectionç®¡ç†**
```typescript
// services/webrtc/PeerConnection.ts
// å®Ÿè£…ã‚¿ã‚¹ã‚¯:
- PeerConnectionãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼
- Offer/Answerç”Ÿæˆ
- ICEå€™è£œå‡¦ç†
- æ¥ç¶šçŠ¶æ…‹ç›£è¦–
```

**Day 13: ãƒ‡ãƒ¼ã‚¿ãƒãƒ£ãƒãƒ«å®Ÿè£…**
```typescript
// services/webrtc/DataChannel.ts
const dataChannelConfig: RTCDataChannelInit = {
  ordered: true,
  maxRetransmits: 3,
  label: 'landmarks',
  protocol: 'json'
};

// å®Ÿè£…å†…å®¹:
- ãƒ‡ãƒ¼ã‚¿ãƒãƒ£ãƒãƒ«ä½œæˆ
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡
- ãƒãƒƒãƒ•ã‚¡ç®¡ç†
- ã‚¨ãƒ©ãƒ¼ãƒªã‚«ãƒãƒªãƒ¼
```

**Day 14: ãƒ“ãƒ‡ã‚ªè¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**
- [ ] LocalVideo.tsxï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒ“ãƒ‡ã‚ªè¡¨ç¤ºï¼‰
- [ ] RemoteVideoGrid.tsxï¼ˆãƒªãƒ¢ãƒ¼ãƒˆãƒ“ãƒ‡ã‚ªã‚°ãƒªãƒƒãƒ‰ï¼‰
- [ ] ãƒ“ãƒ‡ã‚ªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆãƒŸãƒ¥ãƒ¼ãƒˆã€ã‚«ãƒ¡ãƒ©åˆ‡æ›¿ï¼‰
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

**Day 15: çµ±åˆã¨ãƒ‡ãƒãƒƒã‚°**
- [ ] å®Œå…¨ãªãƒ”ã‚¢æ¥ç¶šãƒ•ãƒ­ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
- [ ] è¤‡æ•°ãƒ”ã‚¢æ¥ç¶šã®æ¤œè¨¼
- [ ] ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ‡æ–­/å†æ¥ç¶šãƒ†ã‚¹ãƒˆ
- [ ] WebRTCçµ±è¨ˆæƒ…å ±ã®åé›†

**æˆæœç‰©**:
- å‹•ä½œã™ã‚‹ãƒ“ãƒ‡ã‚ªé€šè©±æ©Ÿèƒ½
- ãƒ‡ãƒ¼ã‚¿ãƒãƒ£ãƒãƒ«é€šä¿¡
- æ¥ç¶šå“è³ªã®å¯è¦–åŒ–

---

#### Phase 5: MediaPipeçµ±åˆã¨ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ï¼ˆ5æ—¥é–“ï¼‰

**ç›®çš„**: é¡”èªè­˜ã«ã‚ˆã‚‹ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ¤œå‡ºã¨å…±æœ‰

**Day 16: MediaPipe Web Workerå®Ÿè£…**
```typescript
// workers/mediapipe.worker.ts
// å®Ÿè£…å†…å®¹:
- FaceLandmarkeråˆæœŸåŒ–
- ãƒ•ãƒ¬ãƒ¼ãƒ å‡¦ç†ãƒ«ãƒ¼ãƒ—
- ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯æŠ½å‡º
- Workeré€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«
```

**Day 17: ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯**
```typescript
// services/mediapipe/ReactionProcessor.ts
// å®Ÿè£…ã‚¿ã‚¹ã‚¯:
- ãƒ–ãƒ¬ãƒ³ãƒ‰ã‚·ã‚§ã‚¤ãƒ—åˆ†æ
- è¡¨æƒ…ã‚¹ã‚³ã‚¢è¨ˆç®—
- ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°å‡¦ç†
- ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
```

**Day 18: useMediaPipeãƒ•ãƒƒã‚¯**
```typescript
// hooks/useMediaPipe.ts
// å®Ÿè£…å†…å®¹:
- Workerãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†
- ãƒ“ãƒ‡ã‚ªãƒ•ãƒ¬ãƒ¼ãƒ é€ä¿¡
- ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³å€¤ã®å—ä¿¡
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
```

**Day 19: ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤ºUI**
- [ ] ReactionIndicator.tsxï¼ˆãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³å€¤è¡¨ç¤ºï¼‰
- [ ] ReactionChart.tsxï¼ˆå±¥æ­´ã‚°ãƒ©ãƒ•ï¼‰
- [ ] ReactionOverlay.tsxï¼ˆãƒ“ãƒ‡ã‚ªã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼‰
- [ ] ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ

**Day 20: ãƒ‡ãƒ¼ã‚¿ãƒãƒ£ãƒãƒ«çµ±åˆ**
- [ ] ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡
- [ ] ãƒªãƒ¢ãƒ¼ãƒˆãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å—ä¿¡
- [ ] ReactionContextã®å®Œæˆ
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸã®æ¤œè¨¼

**æˆæœç‰©**:
- å®Œå…¨ãªãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ 
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…±æœ‰æ©Ÿèƒ½
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–æ¸ˆã¿

**ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™**:
- 30 FPS ã§ã®å®‰å®šå‹•ä½œ
- CPUä½¿ç”¨ç‡ < 40%
- ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· < 100ms

---

#### Phase 6: å“è³ªä¿è¨¼ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆï¼ˆ3æ—¥é–“ï¼‰

**ç›®çš„**: ãƒ†ã‚¹ãƒˆã€æœ€é©åŒ–ã€ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæº–å‚™

**Day 21: ãƒ†ã‚¹ãƒˆå®Ÿè£…**
```bash
# ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
npm install -D jest @testing-library/react @testing-library/jest-dom

# E2Eãƒ†ã‚¹ãƒˆ
npm install -D @playwright/test

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test
npm run test:e2e
```

**Day 22: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
- [ ] ãƒãƒ³ãƒ‰ãƒ«åˆ†å‰²è¨­å®š
- [ ] é…å»¶ãƒ­ãƒ¼ãƒ‰å®Ÿè£…
- [ ] ãƒ¡ãƒ¢åŒ–ã®è¿½åŠ 
- [ ] ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ã¨æœ€é©åŒ–

**Day 23: ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæº–å‚™**
- [ ] ãƒ“ãƒ«ãƒ‰è¨­å®šã®æœ€çµ‚èª¿æ•´
- [ ] DockeråŒ–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- [ ] ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ
- [ ] é‹ç”¨æ‰‹é †æ›¸ã®ä½œæˆ

**æœ€çµ‚æˆæœç‰©**:
- ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ¬ãƒ‡ã‚£ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
- å®Œå…¨ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ
- ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆè³‡æ

---

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ä¸¦è¡Œé–‹ç™ºï¼ˆ7æ—¥é–“ï¼‰

Phase 1-3ã¨ä¸¦è¡Œã—ã¦å®Ÿæ–½:

**Day 1-2: ã‚¤ãƒ³ãƒ•ãƒ©æ§‹ç¯‰**
- [ ] VPSã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [ ] Dockerç’°å¢ƒæ§‹ç¯‰
- [ ] Ion-SFUè¨­å®š

**Day 3-5: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…**
- [ ] ã‚·ã‚°ãƒŠãƒªãƒ³ã‚°ã‚µãƒ¼ãƒãƒ¼
- [ ] Redisçµ±åˆ
- [ ] åŸºæœ¬API

**Day 6-7: çµ±åˆãƒ†ã‚¹ãƒˆ**
- [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ã®æ¥ç¶šç¢ºèª
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œè¨¼

### å®Ÿè£…å®Œäº†åŸºæº–

#### å„ãƒ•ã‚§ãƒ¼ã‚ºã®å®Œäº†åŸºæº–

**Phase 1-2ï¼ˆåŸºç›¤ï¼‰**
- [ ] ã™ã¹ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¨ãƒ©ãƒ¼ãªãå‹•ä½œ
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼ãŒå®Œçµ
- [ ] åŸºæœ¬çš„ãªã‚¨ãƒ©ãƒ¼å‡¦ç†å®Ÿè£…

**Phase 3-4ï¼ˆé€šä¿¡ï¼‰**
- [ ] å®‰å®šã—ãŸWebSocketæ¥ç¶š
- [ ] ãƒ“ãƒ‡ã‚ªé€šè©±ã®æˆåŠŸç‡ > 95%
- [ ] å†æ¥ç¶šæ©Ÿèƒ½ã®å‹•ä½œç¢ºèª

**Phase 5ï¼ˆMediaPipeï¼‰**
- [ ] 30 FPSã§ã®å®‰å®šå‹•ä½œ
- [ ] ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ¤œå‡ºç²¾åº¦ > 80%
- [ ] ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· < 100ms

**Phase 6ï¼ˆå“è³ªï¼‰**
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ > 70%
- [ ] Lighthouse ã‚¹ã‚³ã‚¢ > 80
- [ ] ãƒ“ãƒ«ãƒ‰ã‚µã‚¤ã‚º < 5MB

---

## ğŸ“Š æˆåŠŸæŒ‡æ¨™

### æŠ€è¡“æŒ‡æ¨™
| æŒ‡æ¨™ | MVPç›®æ¨™ | æœ¬ç•ªç›®æ¨™ |
|------|---------|----------|
| é…å»¶ (P50) | <200ms | <100ms |
| é…å»¶ (P95) | <500ms | <300ms |
| åŒæ™‚æ¥ç¶š | 10äºº | 30äºº |
| ç¨¼åƒç‡ | 95% | 99.5% |
| CPUä½¿ç”¨ç‡ | <70% | <50% |
| ãƒ¡ãƒ¢ãƒªä½¿ç”¨ | <2GB | <4GB |

### ãƒ“ã‚¸ãƒã‚¹æŒ‡æ¨™
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦: 4.0/5.0ä»¥ä¸Š
- å¹³å‡ã‚»ãƒƒã‚·ãƒ§ãƒ³æ™‚é–“: 20åˆ†ä»¥ä¸Š
- ãƒªãƒ†ãƒ³ã‚·ãƒ§ãƒ³ç‡: 30æ—¥ã§40%ä»¥ä¸Š

---

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨å¯¾å‡¦æ³•

| å•é¡Œ | åŸå›  | å¯¾å‡¦æ³• |
|------|------|--------|
| æ¥ç¶šå¤±æ•— | ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ« | UDP 50000-50100é–‹æ”¾ |
| æ˜ åƒãªã— | ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯éå¯¾å¿œ | H.264ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ |
| é«˜é…å»¶ | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¼»è¼³ | ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆèª¿æ•´ |
| éŸ³å£°é€”åˆ‡ã‚Œ | ãƒ‘ã‚±ãƒƒãƒˆãƒ­ã‚¹ | FECæœ‰åŠ¹åŒ– |
| ã‚¢ãƒ—ãƒªã‚¯ãƒ©ãƒƒã‚·ãƒ¥ | ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ | å®šæœŸçš„ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾ |

### ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«
```bash
# WebRTCçµ±è¨ˆæƒ…å ±
chrome://webrtc-internals

# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨ºæ–­
./scripts/network-test.sh

# ãƒ­ã‚°åé›†
docker-compose logs -f --tail=100

# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
go tool pprof http://localhost:8080/debug/pprof/profile
```

---

## ğŸ“š å‚è€ƒè³‡æ–™

### æŠ€è¡“ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [Ion-SFU Documentation](https://github.com/pion/ion-sfu)
- [MediaPipe Face Detection](https://google.github.io/mediapipe/)
- [WebRTC API](https://webrtc.org/getting-started/overview)
- [Swift WebRTC Integration](https://webrtc.googlesource.com/src/+/refs/heads/master/docs/native-code/ios/)

### é–¢é€£ä»•æ§˜
- [RFC 8831: WebRTC Data Channels](https://datatracker.ietf.org/doc/html/rfc8831)
- [Facial Action Coding System](https://en.wikipedia.org/wiki/Facial_Action_Coding_System)

---

**çµ±åˆå®Œäº†ï¼ã“ã®è¨­è¨ˆæ›¸ã§å…¨ä½“åƒãŒæŠŠæ¡ã§ãã€å®Ÿè£…æ–¹å¼ã‚‚é¸æŠå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚**